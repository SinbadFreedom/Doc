<!doctype html>
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>æ‹¯æ•‘å•èº«ç‹—</title>
    <meta name="description" content="æ‹¯æ•‘å•èº«ç‹—">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">

    <link rel="stylesheet" href="http://dashidan.com/css/bootstrap.css">
    <link rel="stylesheet" href="http://dashidan.com/css/dashidan.css">
</head>
<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience and security.</p>
<![endif]-->

<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <img src="http://dashidan.com/img/dsd24.png">
            </a>
            <a class="navbar-brand" href="http://dashidan.com/index.html">å¤§å±è›‹æ•™ç¨‹ç½‘</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://dashidan.com/about.html">å…³äº</a></li>
                <li><a href="http://dashidan.com/thanks.html">é¸£è°¢</a></li>

            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <!-- é¡¶éƒ¨é¢åŒ…å±‘å¯¼èˆª-->
    <ol class="breadcrumb">
        <li><a href="http://dashidan.com/index.html">é¦–é¡µ</a></li>
        <li class="active"><a href="http://dashidan.com/article/game/index.html">Game</a></li>
    </ol>
    <hr>
    <div id="xs_index" class="col-sm-3 col-md-3 col-lg-3 col-xs-12 hidden-xs">
        <!-- ç´¢å¼•-->
        <div id="xs_index_close" class="text-right visible-xs" onclick="hideIndex()">
            å…³é—­â
            <hr>
        </div>
        <div>
            <div class="dsd_title">
                <h2>ç©æ¸¸æˆä¸å¦‚åšæ¸¸æˆ</h2>
            </div>
            <div class="dsd_catalog">
                <!--æ ‡é¢˜åŒº-->
                <div class="single_line">
                    <a href="http://dashidan.com/article/game/h5/æ‹¯æ•‘å•èº«ç‹—.html">ğŸ“– æ‹¯æ•‘å•èº«ç‹—</a>
                </div>
            </div>
        </div>
    </div>
    <div id="sx_index_button" class="visible-xs-block" onclick="showIndex()">
        <!-- å°å±æ˜¾ç¤ºç›®å½•-->
        <div id="sx_index_button_text">
            <span style="color: white">ğŸ”–ç›®å½•</span>
        </div>
    </div>
    <div id="xs_content">
        <div class="col-sm-9 col-md-9 col-lg-9">
            <!-- æ–‡ç« å†…å®¹-->
            <div id="xs_content_border">
                <div>
                    <div class="dsd_title"><h1>1.æ‹¯æ•‘å•èº«ç‹—</h1></div>
                    <div class="dsd_catalog"><a href="#â‘ ">â‘  æ¸¸æˆè®¾è®¡</a>
                        <hr>
                        <a href="#â‘¡">â‘¡ å‡†å¤‡å·¥ä½œ</a>
                        <hr>
                        <a href="#â‘¢">â‘¢ HTMLç¼–ç </a>
                        <hr>
                        <a href="#â‘£">â‘£ JavaScriptç¼–ç </a>
                        <hr>
                        <a href="#â‘¤">â‘¤ çŸ¥è¯†ç‚¹æ•´ç†</a>
                        <hr>
                        <a href="#â‘¥">â‘¥ ç›¸å…³æ–‡ç« </a></div>
                </div>
                <div class="jumbotron">
                    <p>ä¸€å¹´ä¸€åº¦çš„å…‰æ£èŠ‚åˆåˆ°äº†!å•èº«ç‹—è¡¨ç¤ºå—åˆ°ä¸€ä¸‡ç‚¹ä¼¤å®³,æ‰€ä»¥è¦ä¸ºå•èº«ç‹—åšç‚¹ä»€ä¹ˆ.æ‹¯æ•‘å•èº«ç‹—!æ©çˆ±ç‹—ç¾¤ä¸­æ•‘å‡ºå•èº«ç‹—!</p>
                </div>
                <div class="dsd_title"><a href="#top" id="â‘ ">â‘  æ¸¸æˆè®¾è®¡ğŸ”</a></div>
                <p>html5å°æ¸¸æˆ, ä»å±å¹•ä¸Šéšæœºå‡ºç°å•èº«ç‹—,æˆ–è€…æƒ…ä¾£ç‹—.</p>
                <p>ç„¶åä»ä¼—å¤šçš„ç‹—ä¸­, é€‰æ‹©å•èº«ç‹—, å°†å•èº«ç‹—è§£æ•‘å‡ºæ¥.</p>
                <p>é€‰ä¸­ä¸€ä¸ªåŠ ä¸€åˆ†, ç‚¹é”™æ¸¸æˆç»“æŸ.</p>
                <p>å°±è¿™æ ·, å¾ˆç®€å•å§.</p>
                <p>ğŸ® <a href="http://dashidan.com/game/save_the_single_dog/index.html">æ‹¯æ•‘å•èº«ç‹—å°æ¸¸æˆ</a></p>
                <div class="dsd_title"><a href="#top" id="â‘¡">â‘¡ å‡†å¤‡å·¥ä½œğŸ”</a></div>
                <ul>
                    <li>èµ„æºå›¾ç‰‡: 4åªå•èº«ç‹—, 4åŒæƒ…ä¾£ç‹—, æ¸¸æˆé—ªå±é¡µé¢</li>
                </ul>
                <p>æ¸¸æˆé—ªå±é¡µé¢:</p>
                <p><img class="center-block img-responsive"
                        src="http://dashidan.com/img/game/save_the_single_dog/splash.jpg" alt="1"/></p>
                <p>å…«éªå›¾:</p>
                <p><img class="center-block img-responsive"
                        src="http://dashidan.com/img/game/save_the_single_dog/dog.jpg" alt="2"/></p>
                <ul>
                    <li>å‹¤åŠ³çš„åŒæ‰‹, è¯´çš„å°±æ˜¯ä½ å•¦.</li>
                    <li>çµæ´»çš„å¤§è„‘, è¿˜æ˜¯ä½ .</li>
                    <li>äº†è§£JavaScript, htmlçš„åŸºç¡€è¯­æ³•å³å¯.</li>
                </ul>
                <div class="dsd_title"><a href="#top" id="â‘¢">â‘¢ HTMLç¼–ç ğŸ”</a></div>
                <p>html5æ–°å¢åŠ äº†<code>canvas</code>æ ‡ç­¾, è¿™ä¸ªæ˜¯æˆ‘ä»¬åšè¿™ä¸ªæ¸¸æˆçš„åŸºç¡€.</p>
                <p>ç½‘é¡µä¸­åµŒå…¥<code>canvas</code>æ ‡ç­¾:</p>
                <pre class="prettyprint"><code class="html language-html">&lt;div class="text-center"&gt;
    &lt;canvas id="myCanvas" width="360" height="640"&gt;Your browser does not support the canvas element.&lt;/canvas&gt;
&lt;/div&gt;
</code></pre>
                <p>æˆ‘ä»¬å°†<code>JavaScript</code>è„šæœ¬æ–°å»ºä¸€ä¸ª, åœ¨htmlé¡µé¢ä¸­å¯¼å…¥</p>
                <pre class="prettyprint"><code class="html language-html">&lt;script src="Game.js"&gt;&lt;/script&gt;
</code></pre>
                <div class="dsd_title"><a href="#top" id="â‘£">â‘£ JavaScriptç¼–ç ğŸ”</a></div>
                <p>é€»è¾‘å†™åœ¨<code>Game.js</code>æ–‡ä»¶ä¸­.</p>
                <h3>1.è·å–ç»˜åˆ¶å¯¹è±¡</h3>
                <pre class="prettyprint"><code class="javascript language-javascript">const canvas = document.getElementById("myCanvas");
const ctx = canvas.getContext("2d");
</code></pre>
                <h3>2.å®šä¹‰æ¸¸æˆå˜é‡</h3>
                <pre class="prettyprint"><code class="javascript language-javascript">/** æ¸¸æˆåŒºåŸŸ*/
const WIDTH = 360;
const HEIGHT = 640;
/** å¸§ç‡*/
const FRAME_INTERVAL = 33;
/** å•èº«ç‹—é€Ÿåº¦*/
const DOG_SPEED_SINGLE = 4;
/** å•èº«ç‹—è·¯, å“‡å¡å•èº«ç‹—æœ‰3æ¡è·¯èµ°*/
const DOG_ROAD = 3;
/** ç‹—æ•°é‡*/
const DOG_NUM = 8;
/** å€’è®¡æ—¶*/
let countDown = 3;
/** æ‹¯æ•‘æ•°é‡*/
let saveCount = 0;
/** æ€»æ•°é‡*/
let totalCount = 0;

const SPRITE_WIDTH = 100;
</code></pre>
                <h3>3.åˆå§‹åŒ–å›¾åƒ</h3>
                <pre class="prettyprint"><code class="javascript language-javascript">let splashImg = new Image();
let logoImg = new Image();
let dogImg = new Image();

logoImg.src = "dashidan_log.jpg";
let loadFinish = false;
logoImg.onload = function () {
    dogImg.src = "dog.jpg";
    dogImg.onload = function () {
        loadFinish = true;
    };
};
</code></pre>
                <h3>4.åˆå§‹åŒ–å›¾åƒ</h3>
                <p>è®¾å®šæ¸¸æˆçŠ¶æ€, æœ¬æ¸¸æˆçš„æ¸¸æˆçŠ¶æ€åˆ†ä¸º: é—ªå±çŠ¶æ€, èƒŒæ™¯å™è¿°çŠ¶æ€, å€’è®¡æ—¶, æ¸¸æˆä¸­, æ¸¸æˆç»“æŸ. è¿™å‡ ä¸ªçŠ¶æ€.</p>
                <pre class="prettyprint"><code class="js language-js">/** é—ªå±çŠ¶æ€*/
const GAME_STATE_SPLASH = 1;
/** èƒŒæ™¯å™è¿°çŠ¶æ€*/
const GAME_STATE_INFO = 2;
/** å€’è®¡æ—¶*/
const GAME_STATE_COUNT_DOWN = 3;
/** æ¸¸æˆä¸­*/
const GAME_STATE_GAMING = 4;
/** æ¸¸æˆç»“æŸ*/
const GAME_STATE_GAME_OVER = 5;
</code></pre>
                <h3>4.è®¾å®šæ¸¸æˆçŠ¶æ€æœº</h3>
                <p>æ¸¸æˆçŠ¶æ€æœºæ¥è¿›è¡Œæ¸¸æˆçŠ¶æ€ç®¡ç†å’Œåˆ‡æ¢çš„åŠŸèƒ½.</p>
                <pre class="prettyprint"><code class="js language-js">function render() {
    if (!loadFinish) {
        return;
    }

    switch (gameState) {
        case GAME_STATE_SPLASH:
            renderSlash();
            break;
        case GAME_STATE_INFO:
            renderText();
            break;
        case GAME_STATE_GAMING:
            renderGame();
            break;
        case GAME_STATE_COUNT_DOWN:
            renderCountDown();
            break;
        case GAME_STATE_GAME_OVER:
            renderGameOver();
            break;
    }
}
</code></pre>
                <h3>5.ç»˜åˆ¶é—ªå±çŠ¶æ€</h3>
                <pre class="prettyprint"><code class="js language-js">function renderSlash() {
    console.log("-----renderSlash--------");
    if (!isDrawSplash) {
        splashImg = new Image();
        splashImg.src = "http://dashidan.com/img/game/save_the_single_dog/splash.jpg";
        splashImg.onload = function () {
            ctx.drawImage(splashImg, 0, 0);
        };
        isDrawSplash = true;
    }

    if (gameStep &gt; 100) {
        ctx.clearRect(0, 0, WIDTH, HEIGHT);

        if (ctx.globalAlpha &gt; 0) {
            ctx.globalAlpha -= 0.01;
        }
        ctx.drawImage(splashImg, 0, 0);
        if (gameStep &gt; 200) {
            updateGameState(GAME_STATE_INFO)
        }
    }
}
</code></pre>
                <h3>5.ç»˜åˆ¶èƒŒæ™¯å™è¿°çŠ¶æ€</h3>
                <pre class="prettyprint"><code class="js language-js">function renderText() {
    console.log("-----renderText--------");

    let textArr = [];
    textArr.push("ä¸€å¹´ä¸€åº¦çš„å…‰æ£èŠ‚åˆåˆ°äº†!");
    textArr.push("å•èº«ç‹—è¡¨ç¤ºå—åˆ°ä¸€ä¸‡ç‚¹ä¼¤å®³");
    textArr.push("æ‰€ä»¥è¦ä¸ºå•èº«ç‹—åšç‚¹ä»€ä¹ˆ");
    textArr.push("æ‹¯æ•‘å•èº«ç‹—!");
    textArr.push("æ©çˆ±ç‹—ç¾¤ä¸­æ•‘å‡ºå•èº«ç‹—!");

    if (gameStep % 5 == 1) {
        if (textArr[textArrayIndex]) {
            if (textIndex &gt;= textArr[textArrayIndex].length) {
                textArrayIndex++;
                textIndex = 0;
            } else {
                ctx.fillStyle = "#000000";
                ctx.font = "20px å¾®è½¯é›…é»‘";
                ctx.fillText(textArr[textArrayIndex].substr(textIndex, 1), 30 * textIndex,
                             100 + textArrayIndex * 30 + 100);
                textIndex++;
            }
        } else {
            updateGameState(GAME_STATE_COUNT_DOWN)
        }
    }
}
</code></pre>
                <h3>6.ç»˜åˆ¶å€’è®¡æ—¶</h3>
                <pre class="prettyprint"><code class="js language-js">function renderCountDown() {
    console.log("-----renderCountDown--------");
    if (gameStep % 30 == 1) {
        if (countDown &gt; 0) {
            ctx.fillStyle = "#666666";
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            ctx.fillStyle = "#000000";
            ctx.font = "100px å¾®è½¯é›…é»‘";
            ctx.fillText(countDown + "", 160, 300);
            countDown--;
        } else {
            updateGameState(GAME_STATE_GAMING)
        }
    }
}
</code></pre>
                <h3>7.å®šä¹‰å•èº«ç‹—çš„ä¿¡æ¯</h3>
                <pre class="prettyprint"><code class="js language-js">class DogInfo {

    constructor(dogIndex, roadIndex, posX, posY) {
        this._dogIndex = dogIndex;
        this._roadIndex = roadIndex;
        this._posX = posX;
        this._posY = posY;
    }

    get dogIndex() {
        return this._dogIndex;
    }

    get roadIndex() {
        return this._roadIndex;
    }

    set posX(value) {
        this._posX = value;
    }

    get posX() {
        return this._posX;
    }

    get posY() {
        return this._posY;
    }

    set posY(value) {
        this._posY = value;
    }
}
</code></pre>
                <h3>8.ç»˜åˆ¶æ¸¸æˆè¿‡ç¨‹</h3>
                <pre class="prettyprint"><code class="js language-js">function renderGame() {
    if (gameStep % FRAME_INTERVAL * 3 == 0) {
        let dogIndex = parseInt(Math.random() * DOG_NUM);
        let roadIndex = parseInt(Math.random() * DOG_ROAD);
        dogOnTheRoad.push(new DogInfo(dogIndex, roadIndex, 0, 0));
        totalCount++;
    }

    ctx.fillStyle = "#666666";
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    for (let i = 0; i &lt; dogOnTheRoad.length; i++) {
        dogOnTheRoad[i].posX = 20 + dogOnTheRoad[i].roadIndex * 110;
        let addY = (DOG_SPEED_SINGLE + parseInt(totalCount / 10));
        dogOnTheRoad[i].posY += addY;
        console.log("addY : " + addY + " dogOnTheRoad[i].posY " + dogOnTheRoad[i].posY);
        ctx.drawImage(dogImg, dogOnTheRoad[i].dogIndex * SPRITE_WIDTH, 0, SPRITE_WIDTH, SPRITE_WIDTH,
                      dogOnTheRoad[i].posX, dogOnTheRoad[i].posY, SPRITE_WIDTH, SPRITE_WIDTH);
    }

    ctx.fillStyle = "#008ace";
    ctx.fillRect(0, 0, WIDTH, 30);
    ctx.fillStyle = "#ffffff";
    ctx.font = "20px å¾®è½¯é›…é»‘";
    ctx.fillText("æ‹¯æ•‘å•èº«ç‹—æ•°é‡: ", 90, 20);
    ctx.fillStyle = "#00ff00";
    ctx.font = "20px å¾®è½¯é›…é»‘";
    ctx.fillText(saveCount + "", 240, 20);
}
</code></pre>
                <h3>9.ç»˜åˆ¶æ¸¸æˆç»“æŸ</h3>
                <pre class="prettyprint"><code>function renderGameOver() {
    ctx.fillStyle = "#000000";
    ctx.fillRect(0, 0, WIDTH, HEIGHT);
    ctx.fillStyle = "#ffffff";
    ctx.font = "40px å¾®è½¯é›…é»‘";
    ctx.fillText("å…±æ‹¯æ•‘å•èº«ç‹—", 60, 260);
    ctx.fillStyle = "#00ff00";
    ctx.font = "40px å¾®è½¯é›…é»‘";
    ctx.fillText(saveCount + "", 160, 300);
    ctx.fillStyle = "#ffffff";
    ctx.font = "40px å¾®è½¯é›…é»‘";
    ctx.fillText("åª!", 160, 340);
}
</code></pre>
                <h3>10.å¾ªç¯æ¸²æŸ“</h3>
                <p><code>JavaScript</code>ä¸­é€šè¿‡<code>setInterval</code>æ–¹æ³•æ¥é—´éš”ä¸€æ®µæ—¶é—´å¾ªç¯æ‰§è¡Œ.</p>
                <pre class="prettyprint"><code class="js language-js">window.setInterval(render, FRAME_INTERVAL);
</code></pre>
                <h3>11.å¤„ç†é¼ æ ‡ç‚¹å‡»äº‹ä»¶</h3>
                <pre class="prettyprint"><code class="js language-js">canvas.addEventListener('click', function (event) {
    if (gameState != GAME_STATE_GAMING) {
        return;
    }

    console.log("ev " + event);
    let x, y;
    if (event.layerX || event.layerX == 0) {
        x = event.layerX;
        y = event.layerY;
    } else if (event.offsetX || event.offsetX == 0) { // Opera
        x = event.offsetX;
        y = event.offsetY;
    }
    console.log("ev " + event + " x " + x + " y " + y);

    for (let i = 0; i &lt; dogOnTheRoad.length; i++) {
        if (dogOnTheRoad[i].dogIndex &lt; 4) {
            if (x &gt;= dogOnTheRoad[i].posX
                &amp;&amp; x &lt;= dogOnTheRoad[i].posX + 100
                &amp;&amp; y &gt;= dogOnTheRoad[i].posY
                &amp;&amp; y &lt;= dogOnTheRoad[i].posY + 100) {
                saveCount++;
                /** ç§»é™¤å•èº«ç‹—*/
                dogOnTheRoad.splice(i, 1);
                return;
            }
        } else {
            /** ç‚¹ä¸­æ©çˆ±ç‹—*/
        }
    }

    updateGameState(GAME_STATE_GAME_OVER)
});
</code></pre>
                <div class="dsd_title"><a href="#top" id="â‘¤">â‘¤ çŸ¥è¯†ç‚¹æ•´ç†ğŸ”</a></div>
                <p>è¿™ä¸ªå°æ¸¸æˆä¸»è¦æ¶‰åŠåˆ°äº†ä»¥ä¸‹çŸ¥è¯†ç‚¹.</p>
                <ul>
                    <li><code>h5</code>çš„<code>canvas</code>æ ‡ç­¾</li>
                    <li><code>html</code>åŠ è½½å¤–éƒ¨<code>JavaScript</code>æ–‡ä»¶</li>
                    <li>è·å–<code>canvas</code>çš„å¹³é¢ç»˜åˆ¶å¯¹è±¡<code>getContext(2d)</code></li>
                    <li><code>JavaScript</code>ä¸­å¸¸é‡å®šä¹‰<code>const</code></li>
                    <li><code>JavaScript</code>ä¸­å±€éƒ¨å˜é‡å®šä¹‰<code>let</code></li>
                    <li><code>JavaScript</code>å›è°ƒå‡½æ•°çš„ä½¿ç”¨</li>
                    <li><code>JavaScript</code>çš„<code>Image</code>å¯¹è±¡</li>
                    <li><code>JavaScript</code>çš„<code>switch</code>æ¡ä»¶æ§åˆ¶è¯­å¥</li>
                    <li><code>canvas</code>ç»˜åˆ¶å›¾åƒ</li>
                    <li><code>canvas</code>å›¾åƒæ¸éš</li>
                    <li><code>canvas</code>ç»˜åˆ¶å­—ä½“</li>
                    <li><code>JavaScript</code>çš„<code>class</code>å¯¹è±¡ä½¿ç”¨</li>
                    <li><code>JavaScript</code>çš„é—´éš”ä¸€å®šæ—¶é—´, å¤šæ¬¡æ‰§è¡Œ</li>
                    <li><code>canvas</code>åŠ¨æ€ç»˜åˆ¶å›¾åƒ</li>
                    <li><code>canvas</code>é¼ æ ‡ç‚¹å‡»äº‹ä»¶å¤„ç†</li>
                </ul>
                <p>å¸Œæœ›é€šè¿‡è¿™ä¸ªå°æ¸¸æˆ, èƒ½æ„Ÿåˆ°ä¸€ç‚¹ç¼–ç¨‹å¸¦æ¥çš„å¿«ä¹, å¹¶èƒ½æŒæ¡å¯¹åº”çš„çŸ¥è¯†ç‚¹.</p>
                <div class="dsd_title"><a href="#top" id="â‘¥">â‘¥ ç›¸å…³æ–‡ç« ğŸ”</a></div>
                <p>ğŸ“– <a href="http://dashidan.com/game/save_the_single_dog/index.html">å¤§å±è›‹æ•™ç¨‹ç½‘</a></p>
                <p>ğŸ® <a href="http://dashidan.com/game/save_the_single_dog/index.html">æ‹¯æ•‘å•èº«ç‹—å°æ¸¸æˆ</a></p>
                <span>ğŸŒŸæœ€æ–°å†…å®¹ä¼šåœ¨æºç«™æ›´æ–°.è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥ğŸŒŸ: <a href="http://dashidan.com/article/game/index.html">http://dashidan.com/article/game/index.html</a>
                </span>
            </div>
        </div>
    </div>
    <!-- åº•éƒ¨é¢åŒ…å±‘å¯¼èˆª-->
    <ol class="breadcrumb">
        <li><a href="http://dashidan.com/index.html">é¦–é¡µ</a></li>
        <li><a href="http://dashidan.com/article/game/index.html">Game</a></li>
    </ol>
    <hr>
    <div class="text-center">
    </div>
</div>

<div style="display:none;">
    <script src="https://s19.cnzz.com/z_stat.php?id=1264355070&web_id=1264355070" language="JavaScript"></script>
</div>

<script src="http://dashidan.com/js/jquery-3.2.1.min.js"></script>
<script src="http://dashidan.com/js/vendor/modernizr-custom.js"></script>
<script src="http://dashidan.com/js/bootstrap.js"></script>
<script src="http://dashidan.com/js/google-code-prettify/run_prettify.js"></script>
<script src="http://dashidan.com/js/main.js"></script>
</body>
</html>
