<!doctype html>
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>MongoDB修改数据</title>
    <meta name="description" content="MongoDB修改数据">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">

    <link rel="stylesheet" href="http://dashidan.com/css/bootstrap.css">
    <link rel="stylesheet" href="http://dashidan.com/css/dashidan.css">
</head>
<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience and security.</p>
<![endif]-->

<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <img src="http://dashidan.com/img/dsd24.png">
            </a>
            <a class="navbar-brand" href="http://dashidan.com/index.html">大屎蛋教程网</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://dashidan.com/about.html">关于</a></li>
                <li><a href="http://dashidan.com/thanks.html">鸣谢</a></li>

            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <!-- 顶部面包屑导航-->
    <ol class="breadcrumb">
        <li><a href="http://dashidan.com/index.html">首页</a></li>
        <li class="active"><a href="http://dashidan.com/article/mongodb/index.html">MongoDB</a></li>
    </ol>
    <hr>
    <div id="xs_index" class="col-sm-3 col-md-3 col-lg-3 col-xs-12 hidden-xs">
        <!-- 索引-->
        <div id="xs_index_close" class="text-right visible-xs" onclick="hideIndex()">
            关闭❎
            <hr>
        </div>
        <div>
            <div class="dsd_title">
                <h2>MongoDB中文手册</h2>
            </div>
            <div class="dsd_catalog">
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB简介.html">📖 1.MongoDB简介</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/Windows安装MongoDB.html">📖 2.Windows安装MongoDB</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/Ubuntu安装MongoDB.html">📖 3.Ubuntu安装MongoDB</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB命令行简介.html">📖 4.MongoDB命令行简介</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/配置mongo命令行参数.html">📖 5.配置mongo命令行参数</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/mongo命令提示符帮助.html">📖 6.mongo命令提示符帮助</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/mongo命令行运行JavaScript脚本.html">📖
                        7.mongo命令行运行JavaScript脚本</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/mongo命令行中的数据类型.html">📖 8.mongo命令行中的数据类型</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/mongo常用命令.html">📖 9.mongo常用命令</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB增删改查操作简介.html">📖 10.MongoDB增删改查操作简介</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB插入命令详解.html">📖 11.MongoDB插入命令详解</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDb查询基本操作详解.html">📖 12.MongoDb查询基本操作详解</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB查询绑定或嵌套的方法.html">📖
                        13.MongoDB查询绑定或嵌套的方法</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB查询返回指定字段.html">📖 14.MongoDB查询返回指定字段</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB查询Null或者空字段.html">📖
                        15.MongoDB查询Null或者空字段</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDb遍历结果cursor.html">📖
                        16.MongoDb遍历结果cursor</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB修改数据.html">📖
                        17.MongoDB修改数据</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB删除操作.html">📖
                        18.MongoDB删除操作</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/MongoDB块写入操作.html">📖
                        19.MongoDB块写入操作</a>
                </div>
                <hr>
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/basic/SQL与MongoDB对应表.html">📖
                        20.SQL与MongoDB对应表</a>
                </div>
            </div>

            <div class="dsd_title">
                <h2>MongoDB附录</h2>
            </div>
            <div class="dsd_catalog">
                <div class="single_line">
                    <a href="http://dashidan.com/article/mongodb/appenda/MongoDb在线测试工具.html">📖 1.MongoDb在线测试工具</a>
                </div>
            </div>
        </div>
    </div>
    <div id="sx_index_button" class="visible-xs-block" onclick="showIndex()">
        <!-- 小屏显示目录-->
        <div id="sx_index_button_text">
            <span style="color: white">🔖目录</span>
        </div>
    </div>
    <div id="xs_content">
        <div class="col-sm-9 col-md-9 col-lg-9">
            <!-- 文章内容-->
            <div id="xs_content_border">
                <div>
                    <div class="dsd_title"><h1>17.MongoDB修改数据</h1></div>
                    <div class="dsd_catalog"><a href="#①">① MongoDB修改操作</a>
                        <hr>
                        <a href="#②">② 初始化数据</a>
                        <hr>
                        <a href="#③">③ MongoDB修改数据格式</a>
                        <hr>
                        <a href="#④">④ MongoDB修改集合中的一条数据</a>
                        <hr>
                        <a href="#⑤">⑤ 修改多条文档</a>
                        <hr>
                        <a href="#⑥">⑥ MongoDB替换数据</a>
                        <hr>
                        <a href="#⑦">⑦ 修改行为</a>
                        <hr>
                        <a href="#⑧">⑧ 插入操作</a>
                        <hr>
                        <a href="#⑨">⑨ 写回执</a>
                        <hr>
                        <a href="#⑩">⑩ 参考文章</a>
                        <hr>
                        <a href="#⑪">⑪ 相关文章</a></div>
                </div>
                <div class="dsd_title"><a href="#top" id="①">① MongoDB修改操作🔝</a></div>
                <pre class="prettyprint"><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)
db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)
db.collection.replaceOne(&lt;filter&gt;, &lt;replacement&gt;, &lt;options&gt;)
</code></pre>
                <div class="dsd_title"><a href="#top" id="②">② 初始化数据🔝</a></div>
                <pre class="prettyprint"><code>db.inventory.insertMany( [
   { item: "canvas", qty: 100, size: { h: 28, w: 35.5, uom: "cm" }, status: "A" },
   { item: "journal", qty: 25, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "mat", qty: 85, size: { h: 27.9, w: 35.5, uom: "cm" }, status: "A" },
   { item: "mousepad", qty: 25, size: { h: 19, w: 22.85, uom: "cm" }, status: "P" },
   { item: "notebook", qty: 50, size: { h: 8.5, w: 11, uom: "in" }, status: "P" },
   { item: "paper", qty: 100, size: { h: 8.5, w: 11, uom: "in" }, status: "D" },
   { item: "planner", qty: 75, size: { h: 22.85, w: 30, uom: "cm" }, status: "D" },
   { item: "postcard", qty: 45, size: { h: 10, w: 15.25, uom: "cm" }, status: "A" },
   { item: "sketchbook", qty: 80, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "sketch pad", qty: 95, size: { h: 22.85, w: 30.5, uom: "cm" }, status: "A" }
]);
</code></pre>
                <p>你可以在以下窗口输入命令测试:</p>
                <iframe class="mws-root" allowfullscreen="" sandbox="allow-scripts allow-same-origin" width="600"
                        height="280" src="https://mws.mongodb.com/?version=3.4"></iframe>
                <div class="dsd_title"><a href="#top" id="③">③ MongoDB修改数据格式🔝</a></div>
                <p>MongoDB中可以通过<a href="https://docs.mongodb.com/manual/reference/operator/update">update operters</a>,
                    例如: <code>$set</code>等, 来修改数据.</p>
                <p>MongoDB的<code>update</code>修改格式:</p>
                <pre class="prettyprint"><code>{
  &lt;update operator&gt;: { &lt;field1&gt;: &lt;value1&gt;, ... },
  &lt;update operator&gt;: { &lt;field2&gt;: &lt;value2&gt;, ... },
  ...
}
</code></pre>
                <div class="dsd_title"><a href="#top" id="④">④ MongoDB修改集合中的一条数据🔝</a></div>
                <p>
                    以下例子通过<code>db.collection.updateOne()</code>方法来修改<code>inventory</code>集合中第一条满足<code>item</code>值等于<code>paper</code>的数据.
                </p>
                <pre class="prettyprint"><code>db.inventory.updateOne(
   { item: "paper" },
   {
     $set: { "size.uom": "cm", status: "P" },
     $currentDate: { lastModified: true }
   }
)
</code></pre>
                <p><code>update</code>操作介绍:</p>
                <ul>
                    <li><code>$set</code>操作符来修改<code>size.uom</code>字段为<code>cm</code>,
                        并且将<code>status</code>改为<code>P</code>.
                    </li>
                    <li><code>$currentDate</code>操作符修改<code>lastModified</code>字段值为当前时间. 如果<code>lastModified</code>字段不存在,
                        将会自动创建一个.
                    </li>
                </ul>
                <div class="dsd_title"><a href="#top" id="⑤">⑤ 修改多条文档🔝</a></div>
                <p>3.2版本新特性</p>
                <p>
                    以下示例使用<code>db.collection.updateMany()</code>方法来修改<code>inventory</code>集合中<code>qty</code>小于<code>50</code>的全部文档.
                </p>
                <pre class="prettyprint"><code>db.inventory.updateMany(
   { "qty": { $lt: 50 } },
   {
     $set: { "size.uom": "in", status: "P" },
     $currentDate: { lastModified: true }
   }
)
</code></pre>
                <div class="dsd_title"><a href="#top" id="⑥">⑥ MongoDB替换数据🔝</a></div>
                <p>通过<code>db.collection.replaceOne()</code>方法来替换除<code>_id</code>字段外其余的值. 第二个参数为新的文档数据.</p>
                <p>执行替换操作时, 需要替换的文档数据中只能包括键值对, 不能包含修改操作符.</p>
                <p>替换文档数据数据格式可以和以前不一样. 可以省略<code>_id</code>字段，因为这个字段值是不可修改的. 如果包含这个值需要和以前的值一样.</p>
                <p>替换代码示例:</p>
                <pre class="prettyprint"><code>db.inventory.replaceOne(
   { item: "paper" },
   { item: "paper", instock: [ { warehouse: "A", qty: 60 }, { warehouse: "B", qty: 40 } ] }
)
</code></pre>
                <div class="dsd_title"><a href="#top" id="⑦">⑦ 修改行为🔝</a></div>
                <h3>1.MongoDB修改的原子性</h3>
                <p>MongoDB中所有写的操作都是文档级的原子性.</p>
                <h3>2.MongoDBz的_id字段</h3>
                <p><code>_id</code>字段一旦设定无法修改, 也不能通过替换方法修改.</p>
                <h3>3.文档数据大小</h3>
                <p>当执行<code>update</code>操作时文档数据大小超过给那个分配的大小时, 会将这个文档重新定位到硬盘中.</p>
                <h3>4.字段顺序</h3>
                <p>MongoDB执行写的操作时保留文档中的字段顺序, 除了以下例外:</p>
                <ul>
                    <li><code>_id</code>字段始终是第一个</li>
                    <li>更新已有字段数据, 会导致字段重新排序</li>
                </ul>
                <p>MonogoDB2.6修改.
                    Mongodb2.6之前不能主动保持字段在文档数据中的数据.</p>
                <div class="dsd_title"><a href="#top" id="⑧">⑧ 插入操作🔝</a></div>
                <p><code>updateOne()</code>, <code>updateMany()</code>, 和<code>replaceOne()</code>这几个操作如果包含了<code>upsert
                    : true</code>时, 如果没有满足指定条件的文档存在, 则自动插入新的数据.</p>
                <div class="dsd_title"><a href="#top" id="⑨">⑨ 写回执🔝</a></div>
                <p>你可以自定义Mongodb写操作的回执等级. 详情查阅<a href="https://docs.mongodb.com/manual/reference/write-concern/">Write
                    Concern</a>.</p>
                <div class="dsd_title"><a href="#top" id="⑩">⑩ 参考文章🔝</a></div>
                <p>📖 <a href="https://docs.mongodb.com/manual/tutorial/update-documents/">https://docs.mongodb.com/manual/tutorial/update-documents/</a>
                </p>
                <div class="dsd_title"><a href="#top" id="⑪">⑪ 相关文章🔝</a></div>
                <p>📖 <a href="http://dashidan.com/article/mongodb/index.html">MongoDB中文文档</a></p>
                <span>🌟最新内容会在源站更新.转载请保留原文链接🌟: <a href="http://dashidan.com/article/mongodb/index.html">http://dashidan.com/article/mongodb/index.html</a>
                </span>
            </div>
        </div>
    </div>
    <!-- 底部面包屑导航-->
    <ol class="breadcrumb">
        <li><a href="http://dashidan.com/index.html">首页</a></li>
        <li><a href="http://dashidan.com/article/mongodb/index.html">MongoDB</a></li>
    </ol>
    <hr>
    <div class="text-center">
        <div>
            <a href="http://dashidan.com/article/mongodb/basic/MongoDB删除操作.html">📖
                下一篇: MongoDB删除操作</a>
        </div>
    </div>
</div>

<div style="display:none;">
    <script src="https://s19.cnzz.com/z_stat.php?id=1264355070&web_id=1264355070" language="JavaScript"></script>
</div>

<script src="http://dashidan.com/js/jquery-3.2.1.min.js"></script>
<script src="http://dashidan.com/js/vendor/modernizr-custom.js"></script>
<script src="http://dashidan.com/js/bootstrap.js"></script>
<script src="http://dashidan.com/js/google-code-prettify/run_prettify.js"></script>
<script src="http://dashidan.com/js/main.js"></script>
</body>
</html>
