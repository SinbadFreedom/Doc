<!doctype html>
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Javaçº¿ç¨‹</title>
    <meta name="description" content="Javaçº¿ç¨‹">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">

    <link rel="stylesheet" href="http://dashidan.com/css/bootstrap.css">
    <link rel="stylesheet" href="http://dashidan.com/css/dashidan.css">
</head>
<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience and security.</p>
<![endif]-->

<nav class="navbar navbar-default">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <img src="http://dashidan.com/img/dsd24.png">
            </a>
            <a class="navbar-brand" href="http://dashidan.com/index.html">å¤§å±è›‹æ•™ç¨‹ç½‘</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://dashidan.com/about.html">å…³äº</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <!-- é¡¶éƒ¨é¢åŒ…å±‘å¯¼èˆª-->
    <ol class="breadcrumb">
        <li><a href="http://dashidan.com/index.html"><b>é¦–é¡µ</b></a></li>
        <li><a href="http://dashidan.com/article/java/index.html"><b>Javaæ•™ç¨‹</b></a></li>
        <li class="active"><a
            href="http://dashidan.com/article/java/basic/index.html"><b>æ•™ç¨‹åˆ—è¡¨</b></a></li>
    </ol>
    <hr>
    <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ-->
    <ul class="nav nav-tabs" role="tablist">
        <li class="active"><a href="http://dashidan.com/article/java/basic/index.html">æ•™ç¨‹åˆ—è¡¨</a></li>
        <li><a href="http://dashidan.com/article/java/addenda/index.html">é™„å½•</a></li>
    </ul>
    <!--æ–‡æ¡£åŒº-->
    <div>
        ğŸ‘¯è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥ğŸ‘‰:<a href="http://dashidan.com/article/java/basic/Javaçº¿ç¨‹.html">http://dashidan.com/article/java/basic/Javaçº¿ç¨‹.html</a>
    </div>

    <div>
        <!-- æ›¿æ¢è¿™ä¸ªåŒºåŸŸ-->
        <div>
            <div class="dsd_title"><h1>18. Javaçº¿ç¨‹</h1></div>
            <div class="dsd_catalog"><a href="#â‘ ">â‘  çº¿ç¨‹å’Œè¿›ç¨‹çš„æ¦‚å¿µ</a>
                <hr>
                <a href="#â‘¡">â‘¡ çº¿ç¨‹çš„å®ç°</a>
                <hr>
                <a href="#â‘¢">â‘¢ Javaçº¿ç¨‹è°ƒåº¦</a>
                <hr>
                <a href="#â‘£">â‘£ Javaä¸­çº¿ç¨‹çš„å®ç°</a>
                <hr>
                <a href="#â‘¤">â‘¤ å¯åŠ¨çº¿ç¨‹</a>
                <hr>
                <a href="#â‘¥">â‘¥ Javaçº¿ç¨‹çš„çŠ¶æ€</a>
                <hr>
                <a href="#â‘¦">â‘¦ çº¿ç¨‹æ­»é”</a>
                <hr>
                <a href="#â‘§">â‘§ synchronizedç”¨åœ¨å¯¹è±¡, æ–¹æ³•, ä»£ç å—çš„åŒºåˆ«</a>
                <hr>
                <a href="#â‘¨">â‘¨ Lockå¯¹è±¡</a>
                <hr>
                <a href="#â‘©">â‘© çº¿ç¨‹å¸¸è§é—®é¢˜ </a>
                <hr>
                <a href="#â‘ª">â‘ª ç›¸å…³æ–‡ç« </a></div>
        </div>
        <div class="jumbotron">
            <p>éƒ¨åˆ†å†…å®¹æºè‡ª:ã€Šæ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºã€‹.
            </p>
        </div>
        <div class="dsd_title"><a href="#top" id="â‘ ">â‘  çº¿ç¨‹å’Œè¿›ç¨‹çš„æ¦‚å¿µğŸ”</a></div>
        <p>è¿›ç¨‹æ˜¯æŒ‡ä¸€ä¸ªå†…å­˜ä¸­è¿è¡Œæœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸€å—å†…å­˜ç©ºé—´çš„åº”ç”¨ç¨‹åº.ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹.</p>
        <p>çº¿ç¨‹æ˜¯æŒ‡è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæµç¨‹.æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„è¿è¡Œæ ˆ. çº¿ç¨‹ä»å±äºè¿›ç¨‹. ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹.è¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜.</p>
        <p>çº¿ç¨‹å’Œè¿›ç¨‹ä¸€æ ·åˆ†ä¸ºäº”ä¸ªé˜¶æ®µ:åˆ›å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡ã€ç»ˆæ­¢.</p>
        <p>å¤šè¿›ç¨‹æ˜¯æŒ‡æ“ä½œç³»ç»Ÿèƒ½åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡(ç¨‹åº).</p>
        <p>å¤šçº¿ç¨‹æ˜¯æŒ‡åœ¨åŒä¸€ç¨‹åºä¸­,æœ‰å¤šä¸ªé¡ºåºæµåœ¨æ‰§è¡Œ.</p>
        <p><img class="center-block img-responsive" src="http://dashidan.com/img/java/basic/18-1.jpg" alt="çº¿ç¨‹"/></p>
        <div class="dsd_title"><a href="#top" id="â‘¡">â‘¡ çº¿ç¨‹çš„å®ç°ğŸ”</a></div>
        <p>çº¿ç¨‹æ˜¯æ¯”è¿›ç¨‹æ›´è½»é‡çº§çš„è°ƒåº¦æ‰§è¡Œå•ä½,çº¿ç¨‹çš„å¼•å…¥,å¯ä»¥æŠŠä¸€ä¸ªè¿›ç¨‹çš„èµ„æºåˆ†é…å’Œæ‰§è¡Œè°ƒåº¦åˆ†å¼€,å„ä¸ªçº¿ç¨‹æ—¢å¯ä»¥å…±äº«è¿›ç¨‹èµ„æº(å†…å­˜åœ°å€ã€æ–‡ä»¶I/Oç­‰),åˆå¯ä»¥ç‹¬ç«‹è°ƒåº¦(çº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½).</p>
        <p>ä¸»æµçš„æ“ä½œç³»ç»Ÿéƒ½æä¾›äº†çº¿ç¨‹å®ç°,Javaè¯­è¨€åˆ™æä¾›äº†åœ¨ä¸åŒç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå¹³å°ä¸‹å¯¹çº¿ç¨‹æ“ä½œçš„ç»Ÿä¸€å¤„ç†.</p>
        <p>Threadç±»ä¸­æ‰€æœ‰å…³é”®æ–¹æ³•éƒ½æ˜¯å£°æ˜ä¸ºNativeçš„,åœ¨Java APIä¸­,æœ¬åœ°æ–¹æ³•å¾€å¾€æ„å‘³ç€è¿™ä¸ªæ–¹æ³•æ²¡æœ‰ä½¿ç”¨æˆ–æ— æ³•ä½¿ç”¨å¹³å°æ— å…³çš„æ‰‹æ®µæ¥å®ç°(å½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸ºäº†æ‰§è¡Œæ•ˆç‡è€Œä½¿ç”¨Nativeæ–¹æ³•)</p>
        <div class="dsd_title"><a href="#top" id="â‘¢">â‘¢ Javaçº¿ç¨‹è°ƒåº¦ğŸ”</a></div>
        <p>Javaçš„çº¿ç¨‹è°ƒåº¦æ–¹å¼æ˜¯æŠ¢å å¼è°ƒåº¦,è™½ç„¶Javaçº¿ç¨‹çš„è°ƒåº¦æ˜¯ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„,ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥â€œå»ºè®®â€ç³»ç»Ÿç»™æŸäº›çº¿ç¨‹å¤šåˆ†é…ä¸€ç‚¹æ‰§è¡Œæ—¶é—´,å¦å¤–çš„ä¸€äº›çº¿ç¨‹åˆ™å¯ä»¥å°‘åˆ†é…ä¸€ç‚¹â€”â€”è¿™é¡¹æ“ä½œå¯ä»¥é€šè¿‡è®¾ç½®ä¼˜å…ˆçº§æ¥å®Œæˆ.</p>
        <p>
            ä¸è¿‡,çº¿ç¨‹çš„ä¼˜å…ˆçº§å¹¶ä¸æ˜¯å¤ªé è°±,å› ä¸ºJavaçº¿ç¨‹æ˜¯é€šè¿‡æ˜ å°„åˆ°åŸç”Ÿçº¿ç¨‹ä¸Šæ¥å®ç°çš„,æ‰€ä»¥çº¿ç¨‹è°ƒåº¦æœ€ç»ˆè¿˜æ˜¯å–å†³äºæ“ä½œç³»ç»Ÿ,è™½ç„¶ç°åœ¨å¾ˆå¤šæ“ä½œç³»ç»Ÿéƒ½æä¾›äº†ä¼˜å…ˆçº§çš„æ¦‚å¿µ,ä½†æ˜¯å¹¶ä¸è§å¾—ä¸Javaçº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸€ä¸€å¯¹åº”.æ¯”å¦‚:Windowsä¸­å°±åªæœ‰7ç§çº¿ç¨‹ä¼˜å…ˆçº§,è€ŒJavaè¯­è¨€ä¸€å…±è®¾ç½®äº†10ä¸ªçº§åˆ«çš„çº¿ç¨‹ä¼˜å…ˆçº§.</p>
        <div class="dsd_title"><a href="#top" id="â‘£">â‘£ Javaä¸­çº¿ç¨‹çš„å®ç°ğŸ”</a></div>
        <p>åœ¨Javaä¸­æƒ³å®ç°å¤šçº¿ç¨‹æœ‰ä¸¤ç§æ‰‹æ®µ,ä¸€ç§æ˜¯é›†æˆThreadç±»,å¦ä¸€ç§å°±æ˜¯å®ç°Runnableæ¥å£.</p>
        <h3>1.ç»§æ‰¿è‡ªThreadç±»</h3>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * ç»§æ‰¿è‡ªThreadç±»
 */
public class MyThread1 extends Thread {

    @Override
    public void run() {
        System.out.println("MyThread1 run.");
    }
}
</code></pre>
        <h3>2.å®ç°Runnableæ¥å£</h3>
        <p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªçº¿ç¨‹ç±»ç»§æ‰¿è‡ªRunnableæ¥å£,å¦‚: </p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * å®ç°Runnableæ¥å£
 */
public class MyThread2 implements Runnable {
    @Override
    public void run() {
        System.out.println("MyThread2 run.");
    }
}
</code></pre>
        <p>å…¥å£ç±»,å®ä¾‹åŒ–çº¿ç¨‹ç±»çš„å¯¹è±¡,å‘åŠ¨å¯åŠ¨çº¿ç¨‹çš„å‘½ä»¤</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 */
public class Demo1 {
    public static void main(String[] args) {
        MyThread1 t1 = new MyThread1();
        /** t1 çº¿ç¨‹å¯åŠ¨*/
        t1.start();
        MyThread2 myThread2 = new MyThread2();
        Thread t2 = new Thread(myThread2);
        /** t2 çº¿ç¨‹å¯åŠ¨*/
        t2.start();
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>MyThread2 run.
MyThread1 run.
</code></pre>
        <div class="bs-callout bs-callout-warning">
            <h4>è¾“å‡ºçš„é¡ºåºå¯èƒ½ä¸ä¸€è‡´</h4>
            <p>å¤šè¿è¡Œå‡ æ¬¡, è¾“å‡ºçš„é¡ºåºå¯èƒ½ä¸ä¸€è‡´, è¿™ä¸ªæ˜¯ç”±äºçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ— æ³•ä¿è¯å¯¼è‡´.</p>
        </div>
        <div class="bs-callout bs-callout-success">
            <h4>ç»§æ‰¿Threadå’Œå®ç°Runnableæ¥å£å¦‚ä½•é€‰æ‹©</h4>
            <p>ç”±äºJavaæ˜¯å•æ ¹ç»§æ‰¿ä½“ç³», å½“ä¸€ä¸ªç±»éœ€è¦ç»§æ‰¿ä¸å…¶ä»–ç±», è¿˜éœ€è¦å…·æœ‰çº¿ç¨‹çš„èƒ½åŠ›, è¿™æ—¶åªèƒ½é‡‡ç”¨å®ç°Runableæ¥å£çš„æ–¹å¼.</p>
        </div>
        <div class="dsd_title"><a href="#top" id="â‘¤">â‘¤ å¯åŠ¨çº¿ç¨‹ğŸ”</a></div>
        <p>åœ¨çº¿ç¨‹çš„Threadå¯¹è±¡ä¸Šè°ƒç”¨start()æ–¹æ³•,è€Œä¸æ˜¯run()æˆ–è€…åˆ«çš„æ–¹æ³•.åœ¨è°ƒç”¨start()æ–¹æ³•ä¹‹å‰,çº¿ç¨‹å¤„äºæ–°çŠ¶æ€ä¸­, æ–°çŠ¶æ€æŒ‡æœ‰ä¸€ä¸ªThreadå¯¹è±¡, ä½†è¿˜æ²¡æœ‰ä¸€ä¸ªçœŸæ­£çš„çº¿ç¨‹.
            åœ¨è°ƒç”¨start()æ–¹æ³•ä¹‹å,å‘ç”Ÿäº†ä¸€ç³»åˆ—å¤æ‚çš„äº‹æƒ…</p>
        <ol>
            <li>å¯åŠ¨æ–°çš„æ‰§è¡Œçº¿ç¨‹(å…·æœ‰æ–°çš„è°ƒç”¨æ ˆ).</li>
            <li>è¯¥çº¿ç¨‹ä»æ–°çŠ¶æ€è½¬ç§»åˆ°å¯è¿è¡ŒçŠ¶æ€.</li>
            <li>å½“è¯¥çº¿ç¨‹è·å¾—æœºä¼šæ‰§è¡Œæ—¶,å…¶ç›®æ ‡run()æ–¹æ³•å°†è¿è¡Œ.</li>
        </ol>
        <div class="bs-callout bs-callout-danger">
            <h4>run()æ–¹æ³•</h4>
            <p>å¯¹Javaæ¥è¯´,run()æ–¹æ³•æ˜¯çº¿ç¨‹å¯åŠ¨çš„å…¥å£æ–¹æ³•, åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•. å› æ­¤,åœ¨Runnableä¸Šæˆ–è€…Threadä¸Šè°ƒç”¨runæ–¹æ³•æ˜¯åˆæ³•çš„.ä½†å¹¶ä¸å¯åŠ¨æ–°çš„çº¿ç¨‹.æ‰€ä»¥ä¸å»ºè®®ç›´æ¥è°ƒç”¨run()æ–¹æ³•.</p>
        </div>
        <div class="dsd_title"><a href="#top" id="â‘¥">â‘¥ Javaçº¿ç¨‹çš„çŠ¶æ€ğŸ”</a></div>
        <p>Javaçº¿ç¨‹å…·æœ‰äº”ä¸­åŸºæœ¬çŠ¶æ€</p>
        <ol>
            <li>æ–°å»ºçŠ¶æ€(New)</li>
        </ol>
        <p>åœ¨ç”Ÿæˆçº¿ç¨‹å¯¹è±¡,å¹¶æ²¡æœ‰è°ƒç”¨è¯¥å¯¹è±¡çš„startæ–¹æ³•.å¦‚:</p>
        <pre class="prettyprint"><code class="java language-java">Thread t = new MyThread1();
</code></pre>
        <ol>
            <li>å°±ç»ªçŠ¶æ€(Runnable)</li>
        </ol>
        <p>å½“è°ƒç”¨äº†çº¿ç¨‹å¯¹è±¡çš„startæ–¹æ³•ä¹‹å,è¯¥çº¿ç¨‹å°±è¿›å…¥äº†å°±ç»ªçŠ¶æ€,ä½†æ˜¯æ­¤æ—¶çº¿ç¨‹è°ƒåº¦ç¨‹åºè¿˜æ²¡æœ‰æŠŠè¯¥çº¿ç¨‹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹,æ­¤æ—¶å¤„äºå°±ç»ªçŠ¶æ€.éšæ—¶ç­‰å¾…CPUè°ƒåº¦æ‰§è¡Œ,å¹¶ä¸æ˜¯è¯´æ‰§è¡Œäº†t.start()æ­¤çº¿ç¨‹ç«‹å³å°±ä¼šæ‰§è¡Œ.
            åœ¨çº¿ç¨‹è¿è¡Œä¹‹å,ä»ç­‰å¾…æˆ–è€…ç¡çœ ä¸­å›æ¥ä¹‹å,ä¹Ÿä¼šå¤„äºå°±ç»ªçŠ¶æ€.</p>
        <ol>
            <li>è¿è¡ŒçŠ¶æ€(Running)</li>
        </ol>
        <p>çº¿ç¨‹è°ƒåº¦ç¨‹åºå°†å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹,æ­¤æ—¶çº¿ç¨‹å°±è¿›å…¥äº†è¿è¡ŒçŠ¶æ€,å¼€å§‹è¿è¡Œrunå‡½æ•°å½“ä¸­çš„ä»£ç .å°±ç»ªçŠ¶æ€æ˜¯è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€çš„å”¯ä¸€å…¥å£,ä¹Ÿå°±æ˜¯è¯´,çº¿ç¨‹è¦æƒ³è¿›å…¥è¿è¡ŒçŠ¶æ€æ‰§è¡Œ,é¦–å…ˆå¿…é¡»å¤„äºå°±ç»ªçŠ¶æ€ä¸­.</p>
        <ol>
            <li>é˜»å¡çŠ¶æ€(Blocked)</li>
        </ol>
        <p>çº¿ç¨‹æ­£åœ¨è¿è¡Œçš„æ—¶å€™,æš‚æ—¶æ”¾å¼ƒå¯¹CPUçš„ä½¿ç”¨æƒ,åœæ­¢æ‰§è¡Œ,æ­¤æ—¶è¿›å…¥é˜»å¡çŠ¶æ€.é€šå¸¸æ˜¯ä¸ºäº†ç­‰å¾…æŸä¸ªæ—¶é—´çš„å‘ç”Ÿ(æ¯”å¦‚è¯´æŸé¡¹èµ„æºå°±ç»ª)ä¹‹åå†ç»§ç»­è¿è¡Œ.sleep,suspend,waitç­‰æ–¹æ³•éƒ½å¯ä»¥å¯¼è‡´çº¿ç¨‹é˜»å¡.</p>
        <p>å¤„äºè¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹ç›´åˆ°å…¶è¿›å…¥åˆ°å°±ç»ªçŠ¶æ€,æ‰æœ‰æœºä¼šå†æ¬¡è¢«CPUè°ƒç”¨ä»¥è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€.æ ¹æ®é˜»å¡äº§ç”Ÿçš„åŸå› ä¸åŒ,é˜»å¡çŠ¶æ€åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§:</p>
        <ul>
            <li>ç­‰å¾…é˜»å¡</li>
        </ul>
        <p>è¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•,ä½¿æœ¬çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…é˜»å¡çŠ¶æ€.
            wait()ã€notify()ã€notifyAll()æ˜¯ä¸‰ä¸ªå®šä¹‰åœ¨Objectç±»é‡Œçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶çº¿ç¨‹çš„çŠ¶æ€.
            ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œå¯¹è±¡çš„æ§åˆ¶æƒï¼ˆmonitorï¼‰åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰.
            æ— è®ºæ˜¯æ‰§è¡Œå¯¹è±¡çš„waitã€notifyè¿˜æ˜¯notifyAllæ–¹æ³•ï¼Œå¿…é¡»ä¿è¯å½“å‰è¿è¡Œçš„çº¿ç¨‹å–å¾—äº†è¯¥å¯¹è±¡çš„æ§åˆ¶æƒï¼ˆmonitorï¼‰
            å¦‚æœåœ¨æ²¡æœ‰æ§åˆ¶æƒçš„çº¿ç¨‹é‡Œæ‰§è¡Œå¯¹è±¡çš„ä»¥ä¸Šä¸‰ç§æ–¹æ³•ï¼Œå°±ä¼šæŠ¥java.lang.IllegalMonitorStateExceptionå¼‚å¸¸.</p>
        <p>æ‰§è¡Œæ—¶wait(), sleep()æ—¶ä¼šæŠ›å‡ºInterruptedException, éœ€è¦æ”¾åœ¨try-catchè¯­å¥ä¸­æ‰§è¡Œ.</p>
        <p>æŠ¥é”™ç¤ºä¾‹:</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * çº¿ç¨‹é˜»å¡çŠ¶æ€-wait()
 */
public class WaitThread extends Thread {
    @Override
    public void run() {
        System.out.println("WaitThread run.");
        try {
            System.out.println("WaitThread before wait.");
            this.wait();
            System.out.println("WaitThread after wait.");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
        <p>å…¥å£ç±»:</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * çº¿ç¨‹é˜»å¡çŠ¶æ€ wait()
 */
public class Demo2 {
    public static void main(String[] args) {
        WaitThread waitThread = new WaitThread();
        waitThread.start();
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>WaitThread run.
WaitThread before wait.
Exception in thread "Thread-0" java.lang.IllegalMonitorStateException
    at java.lang.Object.wait(Native Method)
    at java.lang.Object.wait(Object.java:502)
    at com.dashidan.lesson18.WaitThread.run(WaitThread.java:15)
</code></pre>
        <p>çº¿ç¨‹å–å¾—æ§åˆ¶æƒçš„æ–¹æ³•æœ‰ä¸‰ç§:</p>
        <ul>
            <li>æ‰§è¡Œå¯¹è±¡çš„æŸä¸ªåŒæ­¥å®ä¾‹æ–¹æ³•.</li>
            <li>æ‰§è¡Œå¯¹è±¡å¯¹åº”ç±»çš„åŒæ­¥é™æ€æ–¹æ³•.</li>
            <li>æ‰§è¡Œå¯¹è¯¥å¯¹è±¡åŠ åŒæ­¥é”çš„åŒæ­¥å—.</li>
        </ul>
        <p>å¦‚æœå¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•å°±ä¼šä½¿æŒæœ‰è¯¥å¯¹è±¡çš„çº¿ç¨‹æŠŠè¯¥å¯¹è±¡çš„æ§åˆ¶æƒäº¤å‡ºå»ï¼Œç„¶åå¤„äºç­‰å¾…çŠ¶æ€.
            å¦‚æœå¯¹è±¡è°ƒç”¨äº†notifyæ–¹æ³•å°±ä¼šé€šçŸ¥æŸä¸ªæ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„æ§åˆ¶æƒçš„çº¿ç¨‹å¯ä»¥ç»§ç»­è¿è¡Œ, ç”±Javaè™šæ‹Ÿæœºæ¥å†³å®šå“ªä¸ªçº¿ç¨‹ç»§ç»­è¿è¡Œ.
            å¦‚æœå¯¹è±¡è°ƒç”¨äº†notifyAllæ–¹æ³•å°±ä¼šé€šçŸ¥æ‰€æœ‰ç­‰å¾…è¿™ä¸ªå¯¹è±¡æ§åˆ¶æƒçš„çº¿ç¨‹ç»§ç»­è¿è¡Œ
            å¯ä»¥é€šè¿‡synchronizeå…³é”®å­—æ¥è·å–åŒæ­¥é”, ç„¶åå†è°ƒç”¨wait(), notify(), notifyAll().</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * çº¿ç¨‹é˜»å¡çŠ¶æ€ wait() , è·å¾—åŒæ­¥é”
 */
public class Demo3 {

    public static Object object = new Object();

    public static void main(String[] args) {
        WaitThread waitThread = new WaitThread(object);
        waitThread.start();

        try {
            /** ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’*/
            System.out.println("ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’");
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        /** 3ç§’åæ‰§è¡Œ notifyAll */
        synchronized (object) {
            object.notifyAll();
        }
    }
}

class WaitThread extends Thread {
    Object object;

    public WaitThread(Object object) {
        this.object = object;
    }

    @Override
    public void run() {
        System.out.println("WaitThread run.");
        synchronized (object) {
            try {
                System.out.println("WaitThread before lock " + this.getName());
                object.wait();
                System.out.println("WaitThread after lock " + this.getName());
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’
WaitThread run.
WaitThread before lock Thread-0
WaitThread after lock Thread-0
</code></pre>
        <ul>
            <li>åŒæ­¥é˜»å¡</li>
        </ul>
        <p>çº¿ç¨‹åœ¨è·å–synchronizedåŒæ­¥é”å¤±è´¥(å› ä¸ºé”è¢«å…¶å®ƒçº¿ç¨‹æ‰€å ç”¨),å®ƒä¼šè¿›å…¥åŒæ­¥é˜»å¡çŠ¶æ€. å½“é”è¢«é‡Šæ”¾å, å…¶ä»–è·å¾—è¯¥é”çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œ.</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * çº¿ç¨‹é˜»å¡çŠ¶æ€ åŒæ­¥é˜»å¡
 */
public class Demo5 {
    public static Object lock = new Object();

    public static void main(String[] args) {
        SyncThread syncThread = new SyncThread("t1", lock);
        syncThread.start();

        SyncThread syncThread1 = new SyncThread("t2",lock);
        syncThread1.start();
    }
}

class SyncThread extends Thread {
    public Object lock;

    public SyncThread(String name, Object lock) {
        super(name);
        this.lock = lock;
    }

    @Override
    public void run() {
        try {
            synchronized (lock) {
                /** ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªè¯­å¥å—çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…. */
                System.out.println(this.getName() + " before sleep.");
                Thread.sleep(3000);
                System.out.println(this.getName() + " after sleep.");
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>t2 before sleep.
t2 after sleep.
t1 before sleep.
t1 after sleep.
</code></pre>
        <div class="bs-callout bs-callout-success">
            <h4>å¤šè¿è¡Œå‡ æ¬¡, è¾“å‡ºç»“æœå¯èƒ½ä¸ä¸€è‡´, ä½†æ¯æ¬¡éƒ½æ˜¯æ‰§è¡Œå®Œä¸€ä¸ªçº¿ç¨‹, å†æ‰§è¡Œå¦ä¸€ä¸ª.</h4>
        </div>
        <div class="bs-callout bs-callout-success">
            <h4>sleep()æ–¹æ³•ä¼šé‡Šæ”¾cpu, è¿›å…¥ç­‰å¾…æ‰§è¡Œçš„çŠ¶æ€, ä½†ä¸ä¼šé‡Šæ”¾æ‰€æŒå¯¹è±¡çš„é”.</h4>
        </div>
        <ul>
            <li>å…¶ä»–é˜»å¡</li>
        </ul>
        <p>é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„sleep()æˆ–join()æˆ–å‘å‡ºäº†I/Oè¯·æ±‚æ—¶,çº¿ç¨‹ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€.å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶,çº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€.</p>
        <p>sleepç¤ºä¾‹:</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * çº¿ç¨‹é˜»å¡çŠ¶æ€ sleep()
 */
public class Demo4 {
    public static void main(String[] args) {
        SleepThread thread = new SleepThread();
        thread.start();
    }
}

class SleepThread extends Thread {
    @Override
    public void run() {
        try {
            System.out.println("before sleep.");
            /** ä¼‘çœ 3ç§’*/
            Thread.sleep(3000);
            /** 3ç§’åè¾“å‡º*/
            System.out.println("after sleep.");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>before sleep.
after sleep.
</code></pre>
        <ol>
            <li>æ­»äº¡çŠ¶æ€(Dead)</li>
        </ol>
        <p>å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„runæ–¹æ³•æ‰§è¡Œç»“æŸæˆ–è€…è°ƒç”¨stopæ–¹æ³•å,è¯¥çº¿ç¨‹å°±ä¼šæ­»äº¡ç»“æŸç”Ÿå‘½å‘¨æœŸ.å¯¹äºå·²ç»æ­»äº¡çš„çº¿ç¨‹,æ— æ³•å†ä½¿ç”¨startæ–¹æ³•ä»¤å…¶è¿›å…¥å°±ç»ª.</p>
        <div class="dsd_title"><a href="#top" id="â‘¦">â‘¦ çº¿ç¨‹æ­»é”ğŸ”</a></div>
        <p>çº¿ç¨‹æ­»é”æ˜¯æŒ‡2ä¸ªçº¿ç¨‹éƒ½åœ¨åŒæ­¥é˜»å¡çŠ¶æ€, ç­‰å¾…å¯¹è±¡çš„é”, åœ¨å¯¹æ–¹çš„çº¿ç¨‹ä¸­æ— æ³•é‡Šæ”¾. è¿™æ ·ä¼šå¯¼è‡´è¿™ä¸¤ä¸ªçº¿ç¨‹å¡æ­», æ— æ³•ç»§ç»­æ‰§è¡Œ. å¼€å‘æ—¶åº”æåŠ›é¿å….</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;


/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * çº¿ç¨‹æ­»é”
 */
public class Demo6 {

    public static LockObject lockA = new LockObject("LOCK-A");
    public static LockObject lockB = new LockObject("LOCK-B");

    public static void main(String[] args) {
        /** æ³¨æ„è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼ å…¥çš„å‚æ•°ï¼Œé¡ºåºä¸ä¸€æ ·, lockA, lockB*/
        LockThread thread1 = new LockThread("t1", lockA, lockB);
        thread1.start();
        /** æ³¨æ„è¿™ä¸¤ä¸ªçº¿ç¨‹ä¼ å…¥çš„å‚æ•°ï¼Œé¡ºåºä¸ä¸€æ ·, lockB, lockA*/
        LockThread thread2 = new LockThread("t2", lockB, lockA);
        thread2.start();
    }
}

class LockThread extends Thread {

    LockObject lock0;
    LockObject lock1;

    public LockThread(String name, LockObject lock0, LockObject lock1) {
        super(name);
        this.lock0 = lock0;
        this.lock1 = lock1;
    }

    @Override
    public void run() {
        try {
            synchronized (lock0) {
                System.out.println(getName() + "æŒæœ‰å¯¹è±¡é” " + lock0.getName());
                Thread.sleep(3000);
                System.out.println(getName() + "ç­‰å¾…å¯¹è±¡é” " + lock1.getName() + " ... ");
                synchronized (lock1) {
                    System.out.println(getName() + "æŒæœ‰å¯¹è±¡é” " + lock1.getName());
                    Thread.sleep(3000);
                }
                /** Attentionï¼è¿™ä¸€è¡Œå¹¶æ²¡æœ‰è¾“å‡º*/
                System.out.println(getName() + "æ‰§è¡Œå®Œæ¯•");
            }
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}

/**
 * ä¸€ä¸ªç®€å•çš„é”å¯¹è±¡
 */
class LockObject {
    /**
     * å¯¹è±¡åå­—
     */
    private String name;

    public LockObject(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>t1æŒæœ‰å¯¹è±¡é” LOCK-A
t2æŒæœ‰å¯¹è±¡é” LOCK-B
t2ç­‰å¾…å¯¹è±¡é” LOCK-A ...
t1ç­‰å¾…å¯¹è±¡é” LOCK-B ...
</code></pre>
        <div class="bs-callout bs-callout-warning">
            <h4>æ‰§è¡Œå®Œæ¯•è¿™ä¸€å¥å¹¶æ²¡æœ‰è¾“å‡º.</h4>
            <p>æ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹è¿›å…¥äº†çº¿ç¨‹æ­»é”çŠ¶æ€, äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”. ç¼–ç è¿‡ç¨‹ä¸­è¦æåŠ›é¿å…åµŒå¥—è°ƒç”¨é”çš„æƒ…å†µå‡ºç°..</p>
        </div>
        <p>çº¿ç¨‹æ­»é”å¦‚ä½•æ£€æµ‹?
            é™äºç¯‡å¹…é—®é¢˜, æ–°å»ºä¸€ç¯‡æ¥è¯´æ˜.<a href="http://dashidan.com">Javaçº¿ç¨‹æ­»é”æ£€æµ‹</a>.</p>
        <div class="dsd_title"><a href="#top" id="â‘§">â‘§ synchronizedç”¨åœ¨å¯¹è±¡, æ–¹æ³•, ä»£ç å—çš„åŒºåˆ«ğŸ”</a></div>
        <p>synchronizedå…³é”®å­—çš„æœ¬è´¨æ˜¯<code>é”å¯¹è±¡</code>. ç”¨åœ¨å¯¹è±¡ç±»å‹ä¸Š, å³ä¸ºé”å®šç›®æ ‡å¯¹è±¡. ç”¨åœ¨æ–¹æ³•å’Œä»£ç å—ä¸­, è¡¨ç¤ºé”å®šå½“å‰å¯¹è±¡.å¯¹è±¡ä¸€æ—¦è¢«é”å®š,
            æ‰€æœ‰çš„synchonizedå…³é”®å­—ä¿®é¥°çš„åŒºåŸŸéƒ½éœ€è¦ç­‰å¾…é”é‡Šæ”¾åæ‰èƒ½æ‰§è¡Œ.</p>
        <p>å‰è¾¹å‡ ä¸ªä¾‹å­éƒ½æ˜¯synchronizedé”å¯¹è±¡çš„æ–¹å¼.ä¸‹é¢æ¥çœ‹çœ‹ç”¨é”æ–¹æ³•å’Œé”ä»£ç å—.</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * synchronizedé”æ–¹æ³•å’ŒåŒºå—
 */
public class Demo7 {
    public static void main(String[] args) {
        SyncObject syncObject = new SyncObject();
        Demo7Thread t1 = new Demo7Thread("t1", syncObject);
        t1.start();
        Demo7Thread t2 = new Demo7Thread("t2", syncObject);
        t2.start();
    }
}

class SyncObject {

    /**
     * synchronized é”æ–¹æ³•
     */
    public synchronized void testSyncMethod(String name) {
        try {
            System.out.println(name + "è¿è¡ŒtestSyncMethodå¼€å§‹.");
            Thread.sleep(300);
            System.out.println(name + "è¿è¡ŒtestSyncMethodç»“æŸ.");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    /**
     * synchronized é”ä»£ç åŒºå—
     */
    public void testSyncCode(String name) {
        synchronized (this) {
            try {
                System.out.println(name + "è¿è¡ŒtestSyncCodeå¼€å§‹.");
                Thread.sleep(300);
                System.out.println(name + "è¿è¡ŒtestSyncCodeç»“æŸ.");
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}

class Demo7Thread extends Thread {
    SyncObject syncObject;

    public Demo7Thread(String name, SyncObject syncObject) {
        super(name);
        this.syncObject = syncObject;
    }

    @Override
    public void run() {
        syncObject.testSyncMethod(this.getName());
        syncObject.testSyncCode(this.getName());
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>t1è¿è¡ŒtestSyncMethodå¼€å§‹.
t1è¿è¡ŒtestSyncMethodç»“æŸ.
t2è¿è¡ŒtestSyncMethodå¼€å§‹.
t2è¿è¡ŒtestSyncMethodç»“æŸ.
t1è¿è¡ŒtestSyncCodeå¼€å§‹.
t1è¿è¡ŒtestSyncCodeç»“æŸ.
t2è¿è¡ŒtestSyncCodeå¼€å§‹.
t2è¿è¡ŒtestSyncCodeç»“æŸ.
</code></pre>
        <div class="bs-callout">
            <p>è¿è¡Œç»“æœå¯èƒ½ä¸ä¸€æ ·, ä½†å¼€å§‹å’Œç»“æŸæ€»æ˜¯ä¸€ä¸€å¯¹åº”.åœ¨å¼€å§‹å’Œç»“æŸä¹‹é—´æ²¡æœ‰æ‰§è¡Œå…¶ä»–æ–¹æ³•,
                è¯´æ˜éƒ½æ˜¯é”çš„åŒä¸€ä¸ªå¯¹è±¡.å¯ä»¥å°†ä»»æ„ä¸€ä¸ªsynchronizedå±è”½,å†è·‘ä¸€ä¸‹ç¨‹åº,å°±ä¼šå‘ç°è¾“å‡ºä¸­çš„å¼€å§‹å’Œç»“æŸä¸å†ä¸€ä¸€å¯¹åº”.</p>
        </div>
        <div class="dsd_title"><a href="#top" id="â‘¨">â‘¨ Lockå¯¹è±¡ğŸ”</a></div>
        <p>JDK1.5å¼€å§‹æä¾›äº†ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„é”çš„æ–¹å¼.concurrentåŒ…ä¸­Lockå¯¹è±¡.æœ€å¤§çš„ä¼˜åŠ¿æ˜¯å¯ä»¥è¯»å†™é”åˆ†ç¦», åŠ å…¥å†™é”å, è¯»é”éœ€è¦ç­‰å†™é”é‡Šæ”¾åå†è¿›è¡Œ. åŠ å…¥è¯»é”å, è¿˜æ˜¯å¯ä»¥è·å–å†™é”, ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨,
            ä½¿ç”¨å†™é”çš„æ—¶å€™. åŒä¸€ä¸ªå¯¹è±¡å¯ä»¥ä½¿ç”¨å¤šä¸ªLockå¯¹è±¡, é”å®šå¯¹åº”çš„èŒƒå›´, è€Œä¸åƒsynchonizedé”æ•´ä¸ªå¯¹è±¡.
            å®˜æ–¹ä¾‹å­</p>
        <pre class="prettyprint"><code class="java language-java">class CachedData {
    Object data;
    volatile boolean cacheValid;
    final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();

    void processCachedData() {
        rwl.readLock().lock();
        if (!cacheValid) {
            // Must release read lock before acquiring write lock
            rwl.readLock().unlock();
            rwl.writeLock().lock();
            try {
                // Recheck state because another thread might have
                // acquired write lock and changed state before we did.
                if (!cacheValid) {
                    data =...
                    cacheValid = true;
                }
                // Downgrade by acquiring read lock before releasing write lock
                rwl.readLock().lock();
            } finally {
                rwl.writeLock().unlock(); // Unlock write, still hold read
            }
        }
        try {
            use(data);
        } finally {
            rwl.readLock().unlock();
        }
    }
}
</code></pre>
        <p>ä¸€ä¸ªç®€å•çš„è¯»å†™é”ä¾‹å­</p>
        <pre class="prettyprint"><code class="java language-java">package com.dashidan.lesson18;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantReadWriteLock;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * &lt;p&gt;
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  18.Javaçº¿ç¨‹
 * Lockå¯¹è±¡
 */
public class Demo8 {

    public static void main(String[] args) {
        LockObjectReadAndWrite lockObj = new LockObjectReadAndWrite();
        /** å†™çº¿ç¨‹*/
        WriteThread writeThread = new WriteThread("w1", lockObj);
        writeThread.start();
        /** è¯»çº¿ç¨‹*/
        ReadThread readThread = new ReadThread("r1", lockObj);
        readThread.start();
    }
}

class LockObjectReadAndWrite {

    private final Map&lt;String, Integer&gt; m = new HashMap&lt;&gt;();
    private final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();
    private final Lock readLock = rwl.readLock();
    private final Lock writeLock = rwl.writeLock();

    public Integer get(String key, String threadName) {
        System.out.println("åŠ å…¥è¯»é” " + threadName);
        readLock.lock();
        try {
            System.out.println("è¯»å–ä¼‘æ¯1ç§’");
            Thread.sleep(1000);
            return m.get(key);
        } catch (InterruptedException e) {
            e.printStackTrace();
            return -1;
        } finally {
            readLock.unlock();
            System.out.println("é‡Šæ”¾è¯»é” " + threadName);
        }
    }

    public Integer put(String key, Integer value, String threadName) {
        System.out.println("------WriteThread åŠ å…¥å†™é”------ : " + threadName);
        writeLock.lock();
        try {
            System.out.println("å†™å…¥ä¼‘æ¯6ç§’.....");
            Thread.sleep(6000);
            return m.put(key, value);
        } catch (InterruptedException e) {
            e.printStackTrace();
            return -1;
        } finally {
            writeLock.unlock();
            System.out.println("------WriteThread é‡Šæ”¾å†™é”------: " + threadName);
        }
    }
}

class WriteThread extends Thread {

    LockObjectReadAndWrite lockObj;

    public WriteThread(String name, LockObjectReadAndWrite lockObj) {
        super(name);
        this.lockObj = lockObj;
    }

    @Override
    public void run() {
        while (true) {
            /** æŒç»­å†™å…¥*/
            lockObj.put("a", 1, this.getName());
            /** å†™å…¥çº¿ç¨‹ä¼‘æ¯3ç§’*/
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

        }
    }
}

class ReadThread extends Thread {

    LockObjectReadAndWrite lockObj;

    public ReadThread(String name, LockObjectReadAndWrite lockObj) {
        super(name);
        this.lockObj = lockObj;
    }

    @Override
    public void run() {
        while (true) {
            /** æŒç»­è¯»å–*/
            lockObj.get("a", this.getName());
        }
    }
}
</code></pre>
        <p>è¾“å‡º:</p>
        <pre><code>åŠ å…¥è¯»é” r1
è¯»å–ä¼‘æ¯1ç§’
------WriteThread åŠ å…¥å†™é”------ : w1
é‡Šæ”¾è¯»é” r1
å†™å…¥ä¼‘æ¯6ç§’.....
åŠ å…¥è¯»é” r1
------WriteThread é‡Šæ”¾å†™é”------: w1
è¯»å–ä¼‘æ¯1ç§’
é‡Šæ”¾è¯»é” r1
åŠ å…¥è¯»é” r1
è¯»å–ä¼‘æ¯1ç§’
é‡Šæ”¾è¯»é” r1
åŠ å…¥è¯»é” r1
è¯»å–ä¼‘æ¯1ç§’
------WriteThread åŠ å…¥å†™é”------ : w1
å†™å…¥ä¼‘æ¯6ç§’.....
é‡Šæ”¾è¯»é” r1
åŠ å…¥è¯»é” r1
</code></pre>
        <div class="bs-callout">
            <p>è¾“å‡ºç»“æœå¯èƒ½ä¸ä¸€æ ·. ä½†æ¯æ¬¡åŠ ä¸Šå†™é”ä¹‹å, è¯»å–çš„æ“ä½œä¾¿åœæ­¢. é‡Šæ”¾å†™é”å, è¯»å–ç»§ç»­.</p>
        </div>
        <div class="dsd_title"><a href="#top" id="â‘©">â‘© çº¿ç¨‹å¸¸è§é—®é¢˜ ğŸ”</a></div>
        <ul>
            <li>çº¿ç¨‹çš„åå­—</li>
        </ul>
        <p>é»˜è®¤çº¿ç¨‹å:<code>Thread-</code>åŠ <code>ä¸‹ä¸€çº¿ç¨‹æ•°</code>:</p>
        <pre class="prettyprint"><code class="java language-java">public Thread() {
    init(null, null, "Thread-" + nextThreadNum(), 0);
}
</code></pre>
        <p>è‡ªå®šä¹‰çº¿ç¨‹å:</p>
        <p>åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥çº¿ç¨‹å.</p>
        <pre class="prettyprint"><code class="java language-java">public Thread(Runnable target, String name) {
    init(null, target, name, 0);
}
</code></pre>
        <ul>
            <li>è·å–å½“å‰çº¿ç¨‹å¯¹è±¡çš„æ–¹æ³•</li>
        </ul>
        <pre class="prettyprint"><code class="java language-java">Thread.currentThread().
</code></pre>
        <ul>
            <li>å½“çº¿ç¨‹ç›®æ ‡<code>run()</code>æ–¹æ³•ç»“æŸæ—¶, è¯¥çº¿ç¨‹ç»“æŸ.</li>
            <li>ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¯åŠ¨ä¸€æ¬¡, ä¸€æ—¦çº¿ç¨‹å¯åŠ¨, ä¸èƒ½å†é‡æ–°å¯åŠ¨.</li>
            <li>çº¿ç¨‹çš„è°ƒåº¦ç”±Javaè™šæ‹Ÿæœº(JVM)æ§åˆ¶.</li>
        </ul>
        <p>
            åœ¨å•æ ¸CPUçš„ç”µè„‘ä¸Š,å®é™…ä¸Šä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªçº¿ç¨‹,CPUåˆ†æ—¶å¤„ç†,çœ‹ä¸Šå»å‘åŒæ­¥è¿è¡Œä¸€æ ·.å¤šæ ¸CPUçš„ç”µè„‘åŒæ—¶å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹.Javaè™šæ‹Ÿæœºå†³å®šå®é™…è¿è¡Œå“ªä¸ªçº¿ç¨‹.æœ‰å¤šä¸ªå¯è¿è¡Œçº¿ç¨‹æ—¶,å…¶ä¸­çš„æŸä¸€ä¸ªä¼šè¢«Javaè™šæ‹Ÿæœºé€‰ä¸ºå½“å‰çº¿ç¨‹.é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½ä¿è¯çº¿ç¨‹è¿è¡Œçš„å…ˆåé¡ºåº.é‡å­ç†è®ºçš„ä¸Šå¸æ·éª°å­.</p>
        <p><img class="center-block img-responsive" src="http://dashidan.com/img/common/aiyinsitan.jpg" alt="çˆ±å› æ–¯å¦"/></p>
        <div class="dsd_title"><a href="#top" id="â‘ª">â‘ª ç›¸å…³æ–‡ç« ğŸ”</a></div>
        <p>ğŸ“– <a href="http://dashidan.com/article/java/addenda/Javaç¤ºä¾‹ä»£ç ä½¿ç”¨æ–¹æ³•.html">Javaç¤ºä¾‹ä»£ç ä½¿ç”¨æ–¹æ³•</a></p>
    </div>
    <hr>
    <!-- åº•éƒ¨é¢åŒ…å±‘å¯¼èˆª-->
    <ol class="breadcrumb">
        <li><a href="http://dashidan.com/index.html"><b>é¦–é¡µ</b></a></li>
        <li><a href="http://dashidan.com/article/java/index.html"><b>Javaæ•™ç¨‹</b></a></li>
        <li class="active"><a
            href="http://dashidan.com/article/java/basic/index.html"><b>æ•™ç¨‹åˆ—è¡¨</b></a></li>
    </ol>
    <hr>
    <!--<nav>-->
    <div class="text-center">
        <div>
            <a href="http://dashidan.com/article/java/basic/Javaè½¬ä¹‰å­—ç¬¦.html">ğŸ”º ä¸Šä¸€ç¯‡: Javaè½¬ä¹‰å­—ç¬¦</a>
        </div>
        <div>
            <a href="http://dashidan.com/article/java/basic/Javaè®¾è®¡æ¨¡å¼.html">ğŸ”» ä¸‹ä¸€ç¯‡: Javaè®¾è®¡æ¨¡å¼</a>
        </div>
    </div>
    <!--</nav>-->
</div>

<div style="display:none;">
    <script src="https://s19.cnzz.com/z_stat.php?id=1264355070&web_id=1264355070" language="JavaScript"></script>
</div>

<script src="http://dashidan.com/js/jquery-3.2.1.min.js"></script>
<script src="http://dashidan.com/js/vendor/modernizr-custom.js"></script>
<script src="http://dashidan.com/js/bootstrap.js"></script>
<script src="http://dashidan.com/js/google-code-prettify/run_prettify.js"></script>
</body>
</html>
