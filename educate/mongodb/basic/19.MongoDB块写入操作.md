19.MongoDBå—å†™å…¥æ“ä½œ
===


â‘  MongoDBå—å†™å…¥ç®€ä»‹
---

MonogoDBæä¾›äº†åƒä¸€ä¸ªé›†åˆä¸­è¿›è¡Œå—å†™å…¥çš„æ“ä½œ.

MongoDB3.2æ–°ç‰¹æ€§

`db.collection.bulkWrite()`æ–¹æ³•æä¾›äº†æ’å…¥, æ›´æ–°, åˆ é™¤æ“ä½œ. ä¹Ÿå¯ä»¥é€šè¿‡`db.collection.insertMany()`æ–¹æ³•æ‰§è¡Œå—æ’å…¥.

â‘¡ æœ‰åºå’Œæ— åºæ“ä½œ
---

MongoDBæ“ä½œå¯ä»¥æ˜¯æœ‰åºçš„ä¹Ÿå¯ä»¥æ˜¯æ— åºçš„.

æ‰§è¡Œæœ‰åºæ“ä½œæ—¶, MongoDBé¡ºåºæ‰§è¡Œæ“ä½œ. å¦‚æœå‘ç”Ÿäº†é”™è¯¯, MongoDBå°†è¿”å›, å¹¶ä¸”ä¸æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œ.
[ordered Bulk Write](https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-example-bulk-write-operation)

æ‰§è¡Œæ— åºæ“ä½œæ—¶ï¼Œ MongoDBå¹¶è¡Œæ‰§è¡Œæ“ä½œ. å¦‚æœå‘ç”Ÿäº†é”™è¯¯, MongoDBå°†ç»§ç»­æ‰§è¡Œå…¶ä»–çš„æ“ä½œ.
[Unordered Bulk Write](https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-example-unordered-bulk-write)

æœ‰åºæ“ä½œæ¯”æ— åºæ“ä½œæ‰§è¡Œæ…¢, å› ä¸ºæœ‰åºæ“ä½œéœ€è¦ç­‰å¾…å‰ä¸€ä¸ªæ“ä½œæ‰§è¡Œå®Œæ¯•åå†æ‰§è¡Œ.

é»˜è®¤`bulkWrite()`æ–¹æ³•æ‰§è¡Œé¡ºåºæ“ä½œ. é‡‡ç”¨æ— åºæ‰§è¡Œ, åœ¨é€‰é¡¹æ–‡æ¡£æ•°æ®ä¸­è®¾ç½®`ordered : false`.
[Execution of Operations](https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-executionofoperations)

â‘¢ `bulkWrite()`æ–¹æ³•
---


`bulkWrite()`æ–¹æ³•æ”¯æŒä»¥ä¸‹æ•°æ®æ“ä½œ:

* insertOne
* updateOne
* updateMany
* replaceOne
* deleteOne
* deleteMany

æ¯ä¸ªæ“ä½œä½œä¸ºä¸€ä¸ªæ–‡æ¡£ä¼ å…¥ä¸€ä¸ªæ•°ç»„ä¸­.


`bulkWrite()`æ‰§è¡Œå¤šæ¬¡æ“ä½œ

```
try {
   db.characters.bulkWrite(
      [
         { insertOne :
            {
               "document" :
               {
                  "_id" : 4, "char" : "Dithras", "class" : "barbarian", "lvl" : 4
               }
            }
         },
         { insertOne :
            {
               "document" :
               {
                  "_id" : 5, "char" : "Taeln", "class" : "fighter", "lvl" : 3
               }
            }
         },
         { updateOne :
            {
               "filter" : { "char" : "Eldon" },
               "update" : { $set : { "status" : "Critical Injury" } }
            }
         },
         { deleteOne :
            { "filter" : { "char" : "Brisbane"} }
         },
         { replaceOne :
            {
               "filter" : { "char" : "Meldane" },
               "replacement" : { "char" : "Tanys", "class" : "oracle", "lvl" : 4 }
            }
         }
      ]
   );
}
catch (e) {
   print(e);
}
```

è¿”å›ç»“æœ

```
{
   "acknowledged" : true,
   "deletedCount" : 1,
   "insertedCount" : 2,
   "matchedCount" : 2,
   "upsertedCount" : 0,
   "insertedIds" : {
      "0" : 4,
      "1" : 5
   },
   "upsertedIds" : {

   }
}
```


å…¶ä»–å—å†™å…¥ä¾‹å­[bulkWrite() Examples](https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-example-bulk-write-operation)


â‘£ åˆ†ç‰‡é›†åˆå—å†™å…¥ç­–ç•¥
---

è¿™ä¸ªéƒ¨åˆ†æš‚æ—¶ä¸å†™.æ—¥åè¡¥å…….æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹è‹±æ–‡åŸæ–‡.


â‘¤ å‚è€ƒæ–‡ç« 
---

ğŸ“– [https://docs.mongodb.com/manual/core/bulk-write-operations/](https://docs.mongodb.com/manual/core/bulk-write-operations/)

â‘¥ ç›¸å…³æ–‡ç« 
---

ğŸ“–  [MongoDBä¸­æ–‡æ–‡æ¡£](http://localhost/article/mongodb/index.html)

