1 MongoDBä¿®æ”¹æ“ä½œ
===

```
db.collection.updateOne(<filter>, <update>, <options>)
db.collection.updateMany(<filter>, <update>, <options>)
db.collection.replaceOne(<filter>, <replacement>, <options>)
```

2 åˆå§‹åŒ–æ•°æ®
===
```
db.inventory.insertMany( [
   { item: "canvas", qty: 100, size: { h: 28, w: 35.5, uom: "cm" }, status: "A" },
   { item: "journal", qty: 25, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "mat", qty: 85, size: { h: 27.9, w: 35.5, uom: "cm" }, status: "A" },
   { item: "mousepad", qty: 25, size: { h: 19, w: 22.85, uom: "cm" }, status: "P" },
   { item: "notebook", qty: 50, size: { h: 8.5, w: 11, uom: "in" }, status: "P" },
   { item: "paper", qty: 100, size: { h: 8.5, w: 11, uom: "in" }, status: "D" },
   { item: "planner", qty: 75, size: { h: 22.85, w: 30, uom: "cm" }, status: "D" },
   { item: "postcard", qty: 45, size: { h: 10, w: 15.25, uom: "cm" }, status: "A" },
   { item: "sketchbook", qty: 80, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "sketch pad", qty: 95, size: { h: 22.85, w: 30.5, uom: "cm" }, status: "A" }
]);
```

ä½ å¯ä»¥åœ¨ä»¥ä¸‹çª—å£è¾“å…¥å‘½ä»¤æµ‹è¯•:

<iframe class="mws-root" allowfullscreen="" sandbox="allow-scripts allow-same-origin" width="600" height="280" src="https://mws.mongodb.com/?version=3.4"></iframe>

3 MongoDBä¿®æ”¹æ•°æ®æ ¼å¼
===

MongoDBä¸­å¯ä»¥é€šè¿‡[update operters](https://docs.mongodb.com/manual/reference/operator/update), ä¾‹å¦‚: `$set`ç­‰, æ¥ä¿®æ”¹æ•°æ®.

MongoDBçš„`update`ä¿®æ”¹æ ¼å¼:

```
{
  <update operator>: { <field1>: <value1>, ... },
  <update operator>: { <field2>: <value2>, ... },
  ...
}
```

4 MongoDBä¿®æ”¹é›†åˆä¸­çš„ä¸€æ¡æ•°æ®
===


ä»¥ä¸‹ä¾‹å­é€šè¿‡`db.collection.updateOne()`æ–¹æ³•æ¥ä¿®æ”¹`inventory`é›†åˆä¸­ç¬¬ä¸€æ¡æ»¡è¶³`item`å€¼ç­‰äº`paper`çš„æ•°æ®.

```
db.inventory.updateOne(
   { item: "paper" },
   {
     $set: { "size.uom": "cm", status: "P" },
     $currentDate: { lastModified: true }
   }
)
```

`update`æ“ä½œä»‹ç»:

* `$set`æ“ä½œç¬¦æ¥ä¿®æ”¹`size.uom`å­—æ®µä¸º`cm`, å¹¶ä¸”å°†`status`æ”¹ä¸º`P`.
* `$currentDate`æ“ä½œç¬¦ä¿®æ”¹`lastModified`å­—æ®µå€¼ä¸ºå½“å‰æ—¶é—´. å¦‚æœ`lastModified`å­—æ®µä¸å­˜åœ¨, å°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª.

5 ä¿®æ”¹å¤šæ¡æ–‡æ¡£
===

3.2ç‰ˆæœ¬æ–°ç‰¹æ€§

ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨`db.collection.updateMany()`æ–¹æ³•æ¥ä¿®æ”¹`inventory`é›†åˆä¸­`qty`å°äº`50`çš„å…¨éƒ¨æ–‡æ¡£.

```
db.inventory.updateMany(
   { "qty": { $lt: 50 } },
   {
     $set: { "size.uom": "in", status: "P" },
     $currentDate: { lastModified: true }
   }
)
```

6 MongoDBæ›¿æ¢æ•°æ®
===

é€šè¿‡`db.collection.replaceOne()`æ–¹æ³•æ¥æ›¿æ¢é™¤`_id`å­—æ®µå¤–å…¶ä½™çš„å€¼. ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ–°çš„æ–‡æ¡£æ•°æ®.

æ‰§è¡Œæ›¿æ¢æ“ä½œæ—¶, éœ€è¦æ›¿æ¢çš„æ–‡æ¡£æ•°æ®ä¸­åªèƒ½åŒ…æ‹¬é”®å€¼å¯¹, ä¸èƒ½åŒ…å«ä¿®æ”¹æ“ä½œç¬¦.

æ›¿æ¢æ–‡æ¡£æ•°æ®æ•°æ®æ ¼å¼å¯ä»¥å’Œä»¥å‰ä¸ä¸€æ ·. å¯ä»¥çœç•¥`_id`å­—æ®µï¼Œå› ä¸ºè¿™ä¸ªå­—æ®µå€¼æ˜¯ä¸å¯ä¿®æ”¹çš„. å¦‚æœåŒ…å«è¿™ä¸ªå€¼éœ€è¦å’Œä»¥å‰çš„å€¼ä¸€æ ·.

æ›¿æ¢ä»£ç ç¤ºä¾‹:

```
db.inventory.replaceOne(
   { item: "paper" },
   { item: "paper", instock: [ { warehouse: "A", qty: 60 }, { warehouse: "B", qty: 40 } ] }
)
```

7 ä¿®æ”¹è¡Œä¸º
===

###1.MongoDBä¿®æ”¹çš„åŸå­æ€§

MongoDBä¸­æ‰€æœ‰å†™çš„æ“ä½œéƒ½æ˜¯æ–‡æ¡£çº§çš„åŸå­æ€§.

###2.MongoDBzçš„_idå­—æ®µ

`_id`å­—æ®µä¸€æ—¦è®¾å®šæ— æ³•ä¿®æ”¹, ä¹Ÿä¸èƒ½é€šè¿‡æ›¿æ¢æ–¹æ³•ä¿®æ”¹.

###3.æ–‡æ¡£æ•°æ®å¤§å°

å½“æ‰§è¡Œ`update`æ“ä½œæ—¶æ–‡æ¡£æ•°æ®å¤§å°è¶…è¿‡ç»™é‚£ä¸ªåˆ†é…çš„å¤§å°æ—¶, ä¼šå°†è¿™ä¸ªæ–‡æ¡£é‡æ–°å®šä½åˆ°ç¡¬ç›˜ä¸­.

###4.å­—æ®µé¡ºåº

MongoDBæ‰§è¡Œå†™çš„æ“ä½œæ—¶ä¿ç•™æ–‡æ¡£ä¸­çš„å­—æ®µé¡ºåº, é™¤äº†ä»¥ä¸‹ä¾‹å¤–:

* `_id`å­—æ®µå§‹ç»ˆæ˜¯ç¬¬ä¸€ä¸ª
* æ›´æ–°å·²æœ‰å­—æ®µæ•°æ®, ä¼šå¯¼è‡´å­—æ®µé‡æ–°æ’åº

MonogoDB2.6ä¿®æ”¹.
Mongodb2.6ä¹‹å‰ä¸èƒ½ä¸»åŠ¨ä¿æŒå­—æ®µåœ¨æ–‡æ¡£æ•°æ®ä¸­çš„æ•°æ®.

8 æ’å…¥æ“ä½œ
===

`updateOne()`, `updateMany()`, å’Œ`replaceOne()`è¿™å‡ ä¸ªæ“ä½œå¦‚æœåŒ…å«äº†`upsert : true`æ—¶, å¦‚æœæ²¡æœ‰æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„æ–‡æ¡£å­˜åœ¨, åˆ™è‡ªåŠ¨æ’å…¥æ–°çš„æ•°æ®.


9 å†™å›æ‰§
===

ä½ å¯ä»¥è‡ªå®šä¹‰Mongodbå†™æ“ä½œçš„å›æ‰§ç­‰çº§. è¯¦æƒ…æŸ¥é˜…[Write Concern](https://docs.mongodb.com/manual/reference/write-concern/).

10 å‚è€ƒæ–‡ç« 
===

ğŸ“– [https://docs.mongodb.com/manual/tutorial/update-documents/](https://docs.mongodb.com/manual/tutorial/update-documents/)

11 ç›¸å…³æ–‡ç« 
===

ğŸ“– [MongoDBä¸­æ–‡æ–‡æ¡£](http://localhost/article/mongodb/index.html)









