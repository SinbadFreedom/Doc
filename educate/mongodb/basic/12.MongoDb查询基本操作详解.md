12.MongoDbæŸ¥è¯¢åŸºæœ¬æ“ä½œè¯¦è§£
===

Mongodbæä¾›äº†æŸ¥è¯¢æ–‡æ¡£çš„æ–¹æ³•`db.collection.find()`.

ä¾‹å¦‚:
```
db.inventory.insertMany([
   { item: "journal", qty: 25, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
   { item: "notebook", qty: 50, size: { h: 8.5, w: 11, uom: "in" }, status: "A" },
   { item: "paper", qty: 100, size: { h: 8.5, w: 11, uom: "in" }, status: "D" },
   { item: "planner", qty: 75, size: { h: 22.85, w: 30, uom: "cm" }, status: "D" },
   { item: "postcard", qty: 45, size: { h: 10, w: 15.25, uom: "cm" }, status: "A" }
]);
```

ä½ å¯ä»¥åœ¨ä»¥ä¸‹çª—å£è¾“å…¥å‘½ä»¤æµ‹è¯•:

<iframe class="mws-root" allowfullscreen="" sandbox="allow-scripts allow-same-origin" width="600" height="280" src="https://mws.mongodb.com/?version=3.4"></iframe>


â‘  æŸ¥è¯¢ä¸€ä¸ªé›†åˆä¸­å…¨éƒ¨æ•°æ®
---

è¾“å…¥:
```
db.inventory.find( {} )
```

è¿™ä¸ªå¯¹åº”çš„SQLè¯­å¥ä¸º

```
SELECT * FROM inventory
```

â‘¡ æŒ‡å®šæ¡ä»¶æŸ¥è¯¢
---

MongoDBä½¿ç”¨`<field>:<value>`è¡¨è¾¾å¼æ¥æŒ‡å®šæŸ¥è¯¢æ¡ä»¶.

```
{ <field1>: <value1>, ... }
```

ä»¥ä¸‹ä¾‹å­ä¸ºä»`inventory`é›†åˆä¸­æŸ¥æ‰¾`status`ä¸º`D`çš„å…¨éƒ¨æ–‡æ¡£.

```
db.inventory.find( { status: "D" } )
```

è¿™ä¸ªå¯¹åº”SQLè¡¨è¾¾å¼

```
SELECT * FROM inventory WHERE status = "D"
```

â‘¢ é€šè¿‡æ¡ä»¶æ“ä½œç¬¦æ¥è®¾ç½®æŸ¥è¯¢æ¡ä»¶
---

MongoDBæ“ä½œç¬¦åˆ—è¡¨:
[query operators](https://docs.mongodb.com/manual/reference/operator/query/#query-selectors)

æ“ä½œç¬¦ä½¿ç”¨æ–¹å¼:

```
{ <field1>: { <operator1>: <value1> }, ... }
```

ä»¥ä¸‹ä¾‹å­ä¸ºä»`inventory`é›†åˆä¸­æŸ¥æ‰¾`status`ä¸º`A`æˆ–`D`çš„å…¨éƒ¨æ–‡æ¡£.

```
db.inventory.find( { status: { $in: [ "A", "D" ] } } )
```

å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨`$or`æ“ä½œç¬¦æ¥å®ç°ä»¥ä¸Šæ“ä½œ. å½“æ‰§è¡Œç›¸ç­‰æ€§æ£€æŸ¥æ—¶, é‡‡ç”¨`$in`è€Œä¸è¦ç”¨`$or`(ä¸‹æ–‡`ORæ¡ä»¶æŸ¥è¯¢`æœ‰`$or`çš„åº”ç”¨åœºæ™¯ç¤ºä¾‹.).

ç­‰åŒäºSQLè¯­å¥:

```
SELECT * FROM inventory WHERE status in ("A", "D")
```

â‘£ `AND`æ¡ä»¶æŸ¥è¯¢
---

MongoDBå¯ä»¥åŒæ—¶å¤šä¸ªæ¡ä»¶, æŸ¥è¯¢åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶çš„æ–‡æ¡£.

ä»¥ä¸‹ä¸ºæŸ¥è¯¢`inventory`é›†åˆä¸­åŒæ—¶æ»¡è¶³`status`ä¸º`A`å¹¶ä¸”`qty`å°äº`30`çš„å…¨éƒ¨æ–‡æ¡£.

```
db.inventory.find( { status: "A", qty: { $lt: 30 } } )
```

ç­‰åŒäºSQLè¯­å¥:

```
SELECT * FROM inventory WHERE status = "A" AND qty < 30
```

â‘¤ `OR`æ¡ä»¶æŸ¥è¯¢
---

MongoDBä¸­å¯ä»¥å°†å¤šä¸ªæŸ¥è¯¢æ¡ä»¶æ”¾åœ¨æ•°ç»„ä¸­, é€šè¿‡`$or`æ“ä½œç¬¦, æ¥æŸ¥è¯¢æ»¡è¶³å…¶ä¸­è‡³å°‘ä¸€ä¸ªæ¡ä»¶çš„æ–‡æ¡£.

ä»¥ä¸‹ä¸ºæŸ¥è¯¢`inventory`é›†åˆä¸­åŒæ—¶æ»¡è¶³`status`ä¸º`A`æˆ–è€…`qty`å°äº`30`çš„å…¨éƒ¨æ–‡æ¡£.

```
db.inventory.find( { $or: [ { status: "A" }, { qty: { $lt: 30 } } ] } )
```

ç­‰åŒäºSQLè¯­å¥:
```
SELECT * FROM inventory WHERE status = "A" OR qty < 30
```

â‘¥ `AND`å’Œ`OR`è”åˆæŸ¥è¯¢
---

ä»¥ä¸‹ä¸ºæŸ¥è¯¢`inventory`é›†åˆä¸­åŒæ—¶æ»¡è¶³`status`ä¸º`A`çš„, å¹¶ä¸”æ»¡è¶³`qty`å°äº`30`æˆ–è€…`item`æ•°æ®ä»¥`p`å¼€å¤´çš„å…¨éƒ¨æ–‡æ¡£.

```
db.inventory.find( {
     status: "A",
     $or: [ { qty: { $lt: 30 } }, { item: /^p/ } ]
} )
```

å¯¹åº”ä»¥ä¸‹SQLè¯­å¥
```
SELECT * FROM inventory WHERE status = "A" AND ( qty < 30 OR item LIKE "p%")
```

MongoDBçš„`$regex`æ“ä½œç¬¦å¯ä»¥åšå­—ç¬¦ä¸²æ¨¡å¼åŒ¹é….

â‘¦ æŸ¥è¯¢è¡Œä¸º
---

###1.Cursor

`db.collection.find()`æ–¹æ³•è¿”å›ä¸€ä¸ª[cursor](https://docs.mongodb.com/manual/tutorial/iterate-a-cursor/)æ‰§è¡ŒåŒ¹é…çš„æ–‡æ¡£.

###2.è¯»åˆ†ç¦»

MongoDB3.2æ–°ç‰¹æ€§

For reads to replica sets and replica set shards, read concern allows clients to choose a level of isolation for their reads. For more information, see Read Concern.


â‘§ å…¶ä»–æŸ¥è¯¢æ–¹æ³•
---

* db.collection.findOne
* In aggregation pipeline, the $match pipeline stage provides access to MongoDB queries.

`db.collection.findOne()`æ–¹æ³•ç­‰åŒäº`db.collection.find().limit(1)`.

â‘¨ å‚è€ƒæ–‡ç« 
---

ğŸ“– [https://docs.mongodb.com/manual/tutorial/query-documents/](https://docs.mongodb.com/manual/tutorial/query-documents/)

â‘© ç›¸å…³æ–‡ç« 
---

ğŸ“– [MongoDBä¸­æ–‡æ–‡æ¡£](http://localhost/article/mongodb/index.html)