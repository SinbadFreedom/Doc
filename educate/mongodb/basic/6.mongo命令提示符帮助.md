6.mongoå‘½ä»¤æç¤ºç¬¦å¸®åŠ©
===

â‘  mongoå‘½ä»¤è¡Œå‚æ•°å¸®åŠ©
---

é€šè¿‡`--help`å‚æ•°æ˜¾ç¤ºå‘½ä»¤è¡Œå¸®åŠ©ä¿¡æ¯

```
mongo --help
```
æ˜¾ç¤º:
```
MongoDB shell version: 2.0.4
usage: mongo [options] [db address] [file names (ending in .js)]
db address can be:
  foo                   foo database on local machine
  192.169.0.5/foo       foo database on 192.168.0.5 machine
  192.169.0.5:9999/foo  foo database on 192.168.0.5 machine on port 9999
options:
  --shell               run the shell after executing files
  --nodb                don't connect to mongod on startup - no 'db address' 
                        arg expected
  --norc                å¼€å§‹ä¸æ‰§è¡Œ".mongorc.js"æ–‡ä»¶
  --quiet               å®‰é™æ¨¡å¼
  --port arg            ç«¯å£
  --host arg            IP
  --eval arg            è¿è¡Œjavascriptè„šæœ¬
  -u [ --username ] arg ç”¨æˆ·å
  -p [ --password ] arg å¯†ç 
  -h [ --help ]         æ˜¾ç¤ºè¿™ä¸ªå¸®åŠ©ä¿¡æ¯
  --version             ç‰ˆæœ¬å·
  --verbose             increase verbosity
  --ipv6                å¼€å¯IPv6æ”¯æŒ(é»˜è®¤å…³é—­)

```


â‘¡ mongoæŒ‡ä»¤å¸®åŠ©
---

é€šè¿‡å‘½ä»¤æç¤ºç¬¦è¿ä¸Šmongoæ•°æ®åº“å,å¯ä»¥è¾“å…¥`help`æ¥æ˜¾ç¤ºå‘½ä»¤æç¤ºç¬¦å¸®åŠ©.

```
help
```

ä¼šæ˜¾ç¤º:

```
db.help()                    æ•°æ®åº“æ–¹æ³•å¸®åŠ©ä¿¡æ¯
db.mycoll.help()             é›†åˆæ–¹æ³•å¸®åŠ©ä¿¡æ¯
rs.help()                    help on replica set methods
help admin                   ç®¡ç†å‘˜å¸®åŠ©ä¿¡æ¯
help connect                 è¿æ¥æ•°æ®åº“å¸®åŠ©
help keys                    å¿«æ·é”®
help misc                    æ‚é¡¹ä¿¡æ¯å¸®åŠ©
help mr                      mapreduceå¸®åŠ©

show dbs                     æ˜¾ç¤ºå…¨éƒ¨æ•°æ®åº“å
show collections             æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­çš„å…¨éƒ¨é›†åˆå
show users                   æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„å…¨éƒ¨ç”¨æˆ·
show profile                 show most recent system.profile entries with time >= 1ms
show logs                    æ˜¾ç¤ºå¯ä»¥è¿æ¥çš„æ—¥å¿—(`logger`)å
show log [name]              è¾“å‡ºå†…å­˜ä¸­çš„æœ€è¿‘logçš„ç‰‡æ®µ, é»˜è®¤è¾“å‡º`global`
use <db_name>                è®¾å®šå½“å‰æ•°æ®åº“
db.foo.find()                æ˜¾ç¤ºé›†åˆ`foo`ä¸­çš„å¯¹è±¡åˆ—è¡¨
db.foo.find( { a : 1 } )     æŸ¥è¯¢fooé›†åˆä¸­`a == 1`çš„å¯¹è±¡
it                           è¾“å…¥it, ç»§ç»­è¿­ä»£æ˜¾ç¤ºç»“æœ, è¾“å‡ºæ›´å¤šç»“æœ
DBQuery.shellBatchSize = x   è®¾ç½®æ˜¾ç¤ºç»“æœæ¡æ•°
exit                         é€€å‡ºå‘½ä»¤è¡Œ
```

â‘¢ æ•°æ®åº“å¸®åŠ©
---
###1.æ˜¾ç¤ºå…¨éƒ¨æ•°æ®åº“
```
show dbs
```
###2.æ˜¾ç¤ºéƒ¨æ•°æ®æ“ä½œå¸®åŠ©
```
db.help()
```
###3.æ˜¾ç¤ºæ–¹æ³•çš„å®ç°

æ˜¾ç¤ºä¸€ä¸ªæ•°æ®çš„æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè¾“å…¥`db.<method name>`ä¸å¸¦`()`.
ä¾‹å¦‚:
```
db.updateUser
```
æ˜¾ç¤º:
```
test.updateUser
```

â‘£ é›†åˆå¸®åŠ©
---
###1.æ˜¾ç¤ºå…¨éƒ¨é›†åˆ
```
show collections
```
###2.æ˜¾ç¤ºé›†åˆå¸®åŠ©

```
db.collection.help()
```
æ˜¾ç¤º
```
db.collection.find().help() - show DBCursor help
db.collection.count()
db.collection.dataSize()
db.collection.distinct( key ) - eg. db.collection.distinct( 'x' )
db.collection.drop() drop the collection
db.collection.dropIndex(name)
db.collection.dropIndexes()
db.collection.ensureIndex(keypattern[,options]) - options is an object with these possible fields: name, unique, dropDups
db.collection.reIndex()
db.collection.find([query],[fields]) - query is an optional query filter. fields is optional set of fields to return.
											  e.g. db.collection.find( {x:77} , {name:1, x:1} )
db.collection.find(...).count()
db.collection.find(...).limit(n)
db.collection.find(...).skip(n)
db.collection.find(...).sort(...)
db.collection.findOne([query])
db.collection.findAndModify( { update : ... , remove : bool [, query: {}, sort: {}, 'new': false] } )
db.collection.getDB() get DB object associated with collection
db.collection.getIndexes()
db.collection.group( { key : ..., initial: ..., reduce : ...[, cond: ...] } )
db.collection.mapReduce( mapFunction , reduceFunction , <optional params> )
db.collection.remove(query)
db.collection.renameCollection( newName , <dropTarget> ) renames the collection.
db.collection.runCommand( name , <options> ) runs a db command with the given name where the first param is the collection name
db.collection.save(obj)
db.collection.stats()
db.collection.storageSize() - includes free space allocated to this collection
db.collection.totalIndexSize() - size in bytes of all the indexes
db.collection.totalSize() - storage allocated for all data and indexes
db.collection.update(query, object[, upsert_bool, multi_bool])
db.collection.validate( <full> ) - SLOW
db.collection.getShardVersion() - only for use with sharding
db.collection.getShardDistribution() - prints statistics about data distribution in the cluster
```

###3.æ˜¾ç¤ºé›†åˆæ–¹æ³•å®ç°
æ˜¾ç¤ºæ–¹æ³•å®ç°è¾“å…¥`db.<collection>.<method>`, ä¸å¸¦`()`.
ä¾‹å¦‚è¾“å…¥:
```
db.collection.save
```
æ˜¾ç¤º:
```
function (obj) {
    if (obj == null || typeof obj == "undefined") {
        throw "can't save a null";
    }
    if (typeof obj == "number" || typeof obj == "string") {
        throw "can't save a number or string";
    }
    if (typeof obj._id == "undefined") {
        obj._id = new ObjectId;
        return this.insert(obj);
    } else {
        return this.update({_id:obj._id}, obj, true);
    }
}
```

â‘¤ cursorå¸®åŠ©
---

å½“ä½ åœ¨mongoå‘½ä»¤è¡Œä½¿ç”¨`find()`æ–¹æ³•æ—¶, å¯ä»¥ä½¿ç”¨å¾ˆå¤š`cursor`æ–¹æ³•æ¥ä¿®æ”¹`find()`è¡Œä¸ºå’Œç»“æœ.

* æ˜¾ç¤ºfind()æ–¹æ³•å¯ç”¨çš„ä¿®æ”¹å™¨å’Œ`cursor`å¤„ç†æ–¹æ³•

	db.collection.find().help()

æ˜¾ç¤º:
```
> db.collection.find().help()
find() modifiers
	.sort( {...} )
	.limit( n )
	.skip( n )
	.count() - total # of objects matching query, ignores skip,limit
	.size() - total # of objects cursor would return, honors skip,limit
	.explain([verbose])
	.hint(...)
	.showDiskLoc() - adds a $diskLoc field to each returned object

Cursor methods
	.forEach( func )
	.map( func )
	.hasNext()
	.next()
```
* çœ‹`cursor`æ–¹æ³•çš„å®ç°, è¾“å…¥`db.<collection>.find().<method>`, ä¸åŒ…å«`()`.
ä¾‹å¦‚:
```
db.collection.find().toArray
```
æ˜¾ç¤º:
```
> db.collection.find().toArray
function () {
    if (this._arr) {
        return this._arr;
    }
    var a = [];
    while (this.hasNext()) {
        a.push(this.next());
    }
    this._arr = a;
    return a;
}
```

å¸¸ç”¨çš„`cursor`æ–¹æ³•

* hasNext() æŸ¥è¯¢`cursor`æ˜¯å¦è¿˜æœ‰æ•°æ®.
* next() è¿”å›ä¸‹ä¸€ä¸ªæ•°æ®å¯¹è±¡, å¹¶ä¸”`cursor`æŒ‡å‘ä½ç½®åŠ 1.
* forEach(<function>) <function>æ–¹æ³•éå†æ‰§è¡Œå…¨éƒ¨ç»“æœ.<function>åªæœ‰1å‚æ•°, è¿­ä»£å™¨ä¸­æŒ‡å‘çš„å¯¹è±¡.

â‘¥ åŒ…è£…å¯¹è±¡å¸®åŠ©
---
å¯ä»¥é€šè¿‡è¾“å…¥`help misc`æ¥è·å–å¯¹è±¡åŒ…è£…ç±».
```
help misc
```

æ˜¾ç¤º:
```
> help misc
	b = new BinData(subtype,base64str)  create a BSON BinData value
	b.subtype()                         the BinData subtype (0..255)
	b.length()                          length of the BinData data in bytes
	b.hex()                             the data as a hex encoded string
	b.base64()                          the data as a base 64 encoded string
	b.toString()

	b = HexData(subtype,hexstr)         create a BSON BinData value from a hex string
	b = UUID(hexstr)                    create a BSON BinData value of UUID subtype
	b = MD5(hexstr)                     create a BSON BinData value of MD5 subtype

	o = new ObjectId()                  create a new ObjectId
	o.getTimestamp()                    return timestamp derived from first 32 bits of the OID
	o.isObjectId()
	o.toString()
	o.equals(otherid)
```


â‘¦ å‚è€ƒæ–‡ç« 
---

ğŸ“– [https://docs.mongodb.com/manual/tutorial/access-mongo-shell-help/](https://docs.mongodb.com/manual/tutorial/access-mongo-shell-help/)


â‘§ ç›¸å…³æ–‡ç« 
---

ğŸ“– [MongoDBä¸­æ–‡æ–‡æ¡£](http://localhost/article/mongodb/index.html)