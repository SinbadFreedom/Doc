JDK8é›†åˆç±»åº“çš„æ‰¹é‡æ•°æ®æ“ä½œ
===


<div class="jumbotron">
<p>å¼•å…¥æ‰¹é‡æ•°æ®æ“ä½œçš„ç›®çš„æ˜¯åº”ç”¨lambdaå‡½æ•°æ¥å®ç°åŒ…å«å¹¶è¡Œæ“ä½œåœ¨å†…çš„å¤šç§æ•°æ®å¤„ç†åŠŸèƒ½ï¼Œè€Œæ”¯æŒå¹¶è¡Œæ•°æ®æ“ä½œæ˜¯å…¶å…³é”®å†…å®¹.è¿™ä¸ªå¹¶è¡Œæ“ä½œæ˜¯åœ¨Java7 java.util.concurrencyçš„Fork/Joinæœºåˆ¶ä¸Šå®ç°çš„.</p>  
</div>


â‘  æ‰¹é‡æ“ä½œæ¥å£
---

å¼•å…¥æ‰¹é‡æ“ä½œæ¥å£çš„ç›®çš„æ˜¯ç»™Javaé›†åˆç±»åº“å¢åŠ æ‰¹é‡æ“ä½œæ•°æ®çš„æ”¯æŒ.é€šå¸¸ç§°è¿™ç§æ‰¹é‡æ•°æ®æ“ä½œä¸ºâ€œJavaä¸­çš„filter/map/reduceâ€.

æ‰¹é‡æ•°æ®æ“ä½œæœ‰ä¸²è¡Œ(åœ¨å½“å‰çº¿ç¨‹ä¸Š)å’Œå¹¶è¡Œ(ä½¿ç”¨å¤šçº¿ç¨‹)ä¸¤ç§æ“ä½œæ¨¡å¼.

ä¸€èˆ¬ç”¨Lambdaå‡½æ•°æ¥å®šä¹‰å¯¹æ•°æ®çš„æ“ä½œ.ç”±äºLambdaè¡¨è¾¾å¼å·²ç»åº”ç”¨åˆ°Javaè¯­è¨€å’Œæ–°é›†åˆAPIä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ›´åŠ é«˜æ•ˆåœ°åˆ©ç”¨åº•å±‚å¹³å°çš„å¹¶è¡Œç‰¹æ€§.

â‘¡ æµå¼API
---

JDKä¸­å·²ç»å¢åŠ äº†ä¸€ä¸ªæ–°åŒ…java.util.streamï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨Java8é›†åˆç±»åº“æ‰§è¡Œç±»ä¼¼filter/map/reduceçš„æ“ä½œ.è¿™ä¸ªæµå¼APIä½¿æˆ‘ä»¬èƒ½åœ¨æ•°æ®æµä¹‹ä¸Šç¼–å†™ä¸²è¡Œæˆ–è€…å¹¶è¡Œçš„æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤º:

```java
List persons = ..
 //ä¸²è¡Œæ“ä½œ
Stream stream=persons.stream();
 //å¹¶è¡Œæ“ä½œ
Stream parallelStream=persons.parallelStream();
```

å¤„ç†ä¸€æ¡æ•°æ®æµæœ‰ç‚¹åƒè¿­ä»£ï¼Œåªæ˜¯ä¸€æ¡æ•°æ®æµåªèƒ½éå†ä¸€æ¬¡ï¼Œç„¶åå°±ç»“æŸäº†ï¼Œç„¶è€Œæ•°æ®æµä¹Ÿå¯èƒ½æ˜¯æ— å°½çš„ï¼Œè¿™é€šå¸¸æ˜¯è¯´æµæ˜¯â€œæ–­æ–­ç»­ç»­â€çš„-æˆ‘ä»¬ä¸èƒ½æå‰çŸ¥é“æœ‰å¤šå°‘æµå…ƒç´ è¦å¤„ç†.

java.util.stream.Streamæ¥å£æ˜¯æ‰¹é‡æ•°æ®æ“ä½œçš„å…¥å£.æˆ‘ä»¬åœ¨æ‹¿åˆ°æµå¼æ¥å£çš„å¼•ç”¨åï¼Œå°±å¯ä»¥ä½¿ç”¨é›†åˆç±»åº“åšäº›æœ‰è¶£çš„äº‹æƒ…äº†.

å…³äºæ•°æ®æµAPIè¦ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯åœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ä¸ä¼šæ”¹åŠ¨æºæ•°æ®.è¿™æ˜¯è€ƒè™‘åˆ°æ•°æ®æºå¯èƒ½æ ¹æœ¬ä¸å­˜åœ¨ï¼Œæˆ–è€…æ˜¯ç”±äºåŸå§‹æ•°æ®è¿˜è¦åœ¨ä»£ç çš„å…¶å®ƒåœ°æ–¹ä½¿ç”¨.
Streamæºç 

æ•°æ®æµæ¥å£å¯ä»¥ä½¿ç”¨å¤šç§æ•°æ®æºæ¥å¤„ç†æ•°æ®ï¼Œä½¿ç”¨è¿™äº›æµå¼æ–¹æ³•æ‰©å±•æ ‡å‡†JDKç±»åº“ï¼Œå¯ä»¥è·å¾—æ›´å¥½çš„æ•°æ®å¤„ç†ä½“éªŒ.
æ¯«æ— ç–‘é—®ï¼Œé¦–é€‰çš„ç”¨äºæµå¼æ“ä½œçš„æ•°æ®æºæ˜¯é›†åˆ(collections)ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```java
List list;
Stream stream=list.stream();
```

å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§æœ‰è¶£çš„æ•°æ®æºæ˜¯æ‰€è°“çš„ç”Ÿæˆå™¨(generators)ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```java
Random random=new Random();
Stream randomNumbers=Stream.generate(random::nextInt);
       æœ‰å‡ ç§å·¥å…·æ–¹æ³•å¯ä»¥è®¾ç½®æ“ä½œå¤šå¤§èŒƒå›´çš„æ•°æ®:
IntStream range =IntStream.range(0, 50, 10);
range.forEach(System.out::println);// 0, 10, 20, 30, 40
```


æ ‡å‡†ç±»åº“ä¸­ä¹Ÿå·²ç»å­˜åœ¨ä¸€äº›ç±»å¯ä»¥å……å½“æ•°æ®æº.ä¾‹å¦‚ï¼Œ Randomç±»å·²ç»æ‰©å±•äº†ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```java
newRandom()
  .ints()// éšæœºç”Ÿæˆä¸€æ¡çš„æ•´æ•°æ•°æ®æµ
  .limit(10)// æˆ‘ä»¬åªè¦10ä¸ªéšæœºæ•´æ•°
  .forEach(System.out::println);
```

â‘¢ ä¸­é—´æ“ä½œ
---


ä¸­é—´æ“ä½œç”¨æ¥æè¿°åœ¨æ•°æ®æµä¹‹ä¸Šæ‰§è¡Œçš„è½¬æ¢æ“ä½œ(å¯ä»¥ç†è§£ä¸ºä¸€ç§æ˜ å°„æ“ä½œ).filter() å’Œ map()æ˜¯ä¸é”™çš„ä¸­é—´æ“ä½œçš„ä¾‹å­ï¼Œå®ƒä»¬çš„è¿”å›å€¼æ˜¯Streamç±»å‹ï¼Œå› æ­¤å¯ä»¥å…è®¸é“¾å¼æ‰§è¡Œå¤šä¸ªä¸­é—´æ“ä½œ.

ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„ä¸­é—´æ“ä½œ:

* filter æ’é™¤æ‰€æœ‰ä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œå…·ä½“æ¡ä»¶é€šè¿‡Predicateæ¥å£æ¥å®šä¹‰ï¼›
* map æ‰§è¡Œå…ƒç´ çš„æ˜ å°„è½¬æ¢ï¼Œå…·ä½“çš„æ˜ å°„æ–¹å¼ä½¿ç”¨Functionæ¥å£å®šä¹‰ï¼›
* flatMap é€šè¿‡å¦å¤–ä¸€ç§ Streamæ¥å£å°†æ¯ä¸ªæµå…ƒç´ è½¬æ¢æˆé›¶ä¸ªæˆ–è€…æ›´å¤šæµå…ƒç´ 
* peek  å¯¹é‡åˆ°çš„æ¯ä¸ªæµå…ƒç´ æ‰§è¡Œä¸€äº›æ“ä½œ.
* distinct æ ¹æ®æµå…ƒç´ çš„equals(..)ç»“æœæ’é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ 
* sorted ä½¿åç»­æ“ä½œä¸­çš„æµå…ƒç´ å¼ºåˆ¶æŒ‰Comparatorå®šä¹‰çš„æ¯”è¾ƒé€»è¾‘æ’åˆ—.
* limit ä½¿åç»­æ“ä½œåªèƒ½çœ‹åˆ°æœ‰é™æ•°é‡çš„å…ƒç´ .
* substream ä½¿åç»­æ“ä½œåªèƒ½çœ‹åˆ°æŸä¸ªèŒƒå›´å†…çš„å…ƒç´ (ä½¿ç”¨ç´¢å¼•).

ä¸­é—´æ“ä½œä¸­çš„ä¸€äº›ï¼Œå¦‚sorted, distinct å’Œ limitç­‰æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæœ‰çŠ¶æ€çš„æ„æ€æ˜¯è¿™äº›æ“ä½œè¿”å›çš„æ•°æ®æµç»“æœä¾èµ–ä¹‹å‰è¿›è¡Œçš„æ“ä½œçš„ç»“æœ.å¦å¤–ï¼Œæ­£å¦‚Javadocä¸Šè®²çš„ï¼Œæ‰€æœ‰ä¸­é—´æ“ä½œæ˜¯â€œå»¶è¿Ÿæ‰§è¡Œ(lazy)â€
çš„.æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ›´è¯¦ç»†çš„äº†è§£ä¸€äº›ä¸­é—´æ“ä½œ.


###1.Filter

æ•°æ®æµè¿‡æ»¤æ˜¯æˆ‘ä»¬éœ€è¦åšçš„åˆå§‹ä¸”å›ºæœ‰çš„æ“ä½œ.Streamæ¥å£ä¸­æœ‰ä¸€ä¸ªfilter(..)æ–¹æ³•,å®ƒä»¥SAMç±»å‹çš„Predicateæ¥å£ä¸ºå‚æ•°ï¼ŒPredicateæ¥å£ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥å®šä¹‰è¿‡æ»¤è§„åˆ™:

```java
List persons = ...
Stream personsOver18 =persons.stream().filter(p ->p.getAge()>18);
```


###2.Map

Mapæ“ä½œå…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªFunctionæ¥å£ï¼ŒFunctionæ¥å£æ¥æ”¶ä¸€ç§ç±»å‹çš„å‚æ•°ï¼Œç„¶åè¿”å›å…¶ä»–ç±»å‹.é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ä¼ ç»Ÿæ–¹å¼ä¸‹ï¼Œä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ˜¯æ€ä¹ˆå®šä¹‰Mapæ“ä½œçš„:

```java
Stream students =persons.stream()
    .filter(p ->p.getAge()>18)
    .map(new Function<Person, Student>(){
         @Override
        public Student apply(Person person){
        return new Student(person);
        }
    }
);
```

ç°åœ¨æŠŠä¸Šé¢çš„å®ç°æ”¹ç”¨Lambdaè¡¨è¾¾å¼è¯­æ³•ï¼Œä»£ç å¦‚ä¸‹:

```java
Stream map =persons.stream()
    .filter(p ->p.getAge()>18)
    .map(person ->new Student(person));
```

æ—¢ç„¶ä½œä¸ºmap(..)æ–¹æ³•å‚æ•°çš„Lambdaè¡¨è¾¾å¼ä»…ä»…æ˜¯ä½¿ç”¨äº†å‚æ•°(person)ï¼Œè€Œæ²¡æœ‰ç”¨æ­¤å‚æ•°åšå…¶ä»–æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥åœ°æŠŠLambdaè¡¨è¾¾å¼æ”¹å†™ä¸ºæ–¹æ³•å¼•ç”¨:

```java
Stream map =persons.stream()
    .filter(p ->p.getAge()>18)
    .map(Student::new);
```

â‘£ ç»ˆç»“æ“ä½œ
---

æ•°æ®æµå¤„ç†è¿‡ç¨‹é€šå¸¸åŒ…å«ä¸‹é¢å‡ ä¸ªæ­¥éª¤:
1.ä»æŸä¸ªæ•°æ®æºå¤´è·å–åˆ°æ•°æ®æµï¼›
2.æ‰§è¡Œåƒfilter,mapç­‰ç­‰è¿™æ ·çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸­é—´æ“ä½œï¼›
3.æ‰§è¡Œä¸€ä¸ªç»ˆç»“æ“ä½œ.

ç»ˆç»“æ“ä½œå¿…é¡»æ˜¯æœ€åä¸€ä¸ªåœ¨æ•°æ®æµä¸Šæ‰§è¡Œçš„æ“ä½œ.ä¸€æ—¦æ‰§è¡Œäº†ç»ˆç»“æ“ä½œï¼Œæ•°æ®æµå°±â€œæ¶ˆè€—å®Œäº†â€ï¼Œä¸å¯å†ç”¨äº†.
ç°æœ‰å¦‚ä¸‹ä¸€äº›å¯ç”¨çš„ç»ˆç»“æ“ä½œç±»å‹:


* reducers ï¼Œå¦‚reduce(..), count(..), findAny(..),  findFirst(..)ï¼Œå¯ä»¥ç»ˆç»“æ•°æ®æµå¤„ç†è¿‡ç¨‹.æ ¹æ®æ„å›¾,ç»ˆç»“æ“ä½œå¯ä»¥æ˜¯â€œçŸ­è·¯â€æ“ä½œ(ä¸ç”¨å®Œæ•´çš„éå†æ‰€æœ‰æ•°æ®æµ).ä¾‹å¦‚ï¼ŒfindFirst(..)åœ¨ä¸€é‡åˆ°åŒ¹é…çš„å…ƒç´ å°±ä¼šé©¬ä¸Šç»ˆç»“æ•°æ®æµçš„å¤„ç†è¿‡ç¨‹.
* collectors,å°±åƒå…¶åå­—è¡¨ç¤ºçš„,ç”¨æ¥æŠŠå¤„ç†è¿‡çš„å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªç»“æœé›†ä¸­.
* forEach å¯¹æ•°æ®æµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡ŒæŸä¸ªæ“ä½œ.
* iterators ï¼Œå¦‚æœä¸Šé¢çš„æ“ä½œéƒ½ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œé‚£ä¹ˆè¿˜æ˜¯é‡‡ç”¨iteratorsè¿™ç§ä¼ ç»Ÿçš„é›†åˆæ“ä½œæ–¹å¼.


å…¶ä¸­æœ€æœ‰è¶£çš„ç»ˆç»“æ“ä½œç±»å‹æ˜¯æ‰€è°“çš„â€œæ”¶é›†å™¨(collectors)â€:

###1.æ”¶é›†å™¨(collectors)

è™½ç„¶æŠ½è±¡æ•°æ®æµæœ¬è´¨ä¸Šæ˜¯è¿ç»­çš„ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥å®šä¹‰æ•°æ®æµä¸Šçš„æ“ä½œï¼Œä½†æ˜¯è¦è·å¾—æœ€ç»ˆçš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼æ”¶é›†åˆ°æ•°æ®.æ•°æ®æµAPIæä¾›äº†ä¸€äº›æ‰€è°“çš„â€œç»ˆç»“â€æ“ä½œï¼Œè€Œcollect() æ–¹æ³•å°±æ˜¯ç»ˆç»“æ“ä½œçš„å…¶ä¸­ä¸€ä¸ªï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿæ”¶é›†ç»“æœæ•°æ®.

```java
List students =persons.stream()
    .filter(p ->p.getAge()>18)
    .map(Adult::new)
    .collect(new Collector<Student, List>(){ ... });
```

å¹¸å¥½ä½ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦è‡ªå·±å®ç°Collectoræ¥å£.ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå·²ç»å®ç°äº†ä¸€ä¸ªCollectorså·¥å…·ç±»:

```java
List students =persons.stream()
    .filter(p ->p.getAge()>18)
    .map(Student::new)
    .collect(Collectors.toList());
```

é‚£ä¸‡ä¸€æˆ‘ä»¬æƒ³ä½¿ç”¨ç‰¹å®šçš„æ”¶é›†é€»è¾‘æ¥æ”¶é›†ç»“æœï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·åš:
```java
List students =persons.stream()
    .filter(p ->p.getAge()>18)
    .map(Student::new)
    .collect(Collectors.toCollection(ArrayList::new));
```

â‘¤ å¹¶è¡Œå’Œä¸²è¡Œ
---

æ–°å¼æ•°æ®æµAPI çš„ä¸€ä¸ªæœ‰æ„æ€çš„ç‰¹æ€§æ˜¯å®ƒä¸è¦æ±‚ä»å¤´åˆ°å°¾éƒ½ä¸€å®šæ˜¯å¹¶è¡Œæ“ä½œæˆ–è€…ä¸²è¡Œæ“ä½œ.ä¸€å¼€å§‹å¹¶å‘åœ°å¤„ç†æ•°æ®ï¼Œç„¶ååˆ‡æ¢åˆ°ä¸²è¡Œå¤„ç†ï¼Œå¹¶å›åˆ°å¤„ç†æµç¨‹ä¸­çš„ä»»æ„æ­¥éª¤ï¼Œè¿™æ˜¯å¯ä»¥å®ç°çš„ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```java
List students =persons.stream()
    .parallel()
    .filter(p ->p.getAge()>18)// å¹¶å‘åœ°æ‰§è¡Œè¿‡æ»¤æ“ä½œ
    .sequential()
    .map(Student::new)
    .collect(Collectors.toCollection(ArrayList::new));
```

æ•°æ®å¤„ç†æµç¨‹ä¸­çš„å¹¶å‘æ“ä½œä¼šè‡ªæ²»åœ°ç®¡ç†è‡ªèº«ï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥å¤„ç†å¹¶å‘é—®é¢˜ï¼Œè¿™ç®€ç›´å¤ªé…·äº†.


â‘¥ ç›¸å…³æ–‡ç« 
---

ğŸ“– [Javaä»å…¥é—¨åˆ°ç²¾é€šç´¢å¼•](http://localhost/article/java/basic/index.html)



â‘¦ å‚è€ƒæ–‡ç« 
---

ğŸ“– [http://blog.csdn.net/wwwsssaaaddd/article/details/24214219](http://blog.csdn.net/wwwsssaaaddd/article/details/24214219)
