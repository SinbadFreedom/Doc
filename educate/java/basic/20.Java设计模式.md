19.Javaè®¾è®¡æ¨¡å¼
===

<div class="jumbotron">
<p>è½¯ä»¶è®¾è®¡é¢†åŸŸçš„å››ä½ä¸–ç•Œçº§å¤§å¸ˆGang Of Four (GoF):Erich Gamma, Richard Helm, Ralph Johnson,John Vlissidesåˆè‘—äº†ä¸€æœ¬éå¸¸è‘—åçš„ä¹¦ã€ŠDesign Patterns - Elements of Reusable Object-Oriented Softwareã€‹ç¿»è¯‘çš„ä¸­æ–‡åä¸ºã€Šè®¾è®¡æ¨¡å¼:å¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹.ä¹¦ä¸­æå‡ºäº†23ç§åŸºæœ¬è®¾è®¡æ¨¡å¼,ä»ç†è®ºé«˜åº¦æç‚¼å¹¶è§„èŒƒäº†è®¾è®¡æ¨¡å¼,å¯¹é¢å‘å¯¹è±¡è½¯ä»¶è®¾è®¡äº§ç”Ÿäº†å·¨å¤§å½±å“.
</p>
</div>

![å›¾19-1](http://localhost/img/java/basic/19-1.jpg)

â‘  è®¾è®¡æ¨¡å¼ç®€ä»‹
---

æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»:
åˆ›å»ºå‹æ¨¡å¼,å…±äº”ç§:å·¥å‚æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼.
ç»“æ„å‹æ¨¡å¼,å…±ä¸ƒç§:é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼.
è¡Œä¸ºå‹æ¨¡å¼,å…±åä¸€ç§:ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼.

æœ‰äº›è®¾è®¡æ¨¡å¼æˆ‘ä¸ªäººè®¤ä¸º,ä¸æ˜¯å¾ˆå…·è±¡, å°±åƒæ˜Ÿåº§ä¸€æ ·æŠ½è±¡æ¦‚å¿µå±…å¤š,å¯¼è‡´åº”ç”¨åœºæ™¯ä¸æ˜ç¡®. æ‰€ä»¥ä¸å¸Œæœ›ä»–ä»¬å ç”¨æˆ‘è¿‡å¤šçš„è„‘å®¹é‡å’Œæ—¶é—´.åªæŒ‘é€‰å‡ ä¸ªå«é‡‘é‡é«˜, æ¨¡å‹å…·è±¡, åº”ç”¨åœºæ™¯å¹¿æ³›çš„æ¨¡å¼æ¥ä»‹ç». ä»¥ä¸‹è¿™å‡ ä¸ªéƒ½æ˜¯éå¸¸å€¼å¾—èŠ±æ—¶é—´å»ç†Ÿæ‚‰çš„æ¨¡å¼.


â‘¡ å•ä¾‹æ¨¡å¼
---

å•ä¾‹æ¨¡å¼å³æ˜¯åªäº§ç”Ÿä¸€ä¸ªå¯¹è±¡çš„æ¨¡å¼.åœ¨Javaä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨`new`å…³é”®å­—, å°±ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡. æœ‰æ—¶æˆ‘ä»¬éœ€è¦åªæœ‰ä¸€ä¸ªå¯¹è±¡äº§ç”Ÿ, æ¯”å¦‚ä¸€äº›ç®¡ç†ç±», å…¨å±€ç®¡ç†å…¶å®ƒæ¨¡å—æ—¶, è¿™ä¸ªç®¡ç†ç±»é€‚åˆé‡‡ç”¨å•ä¾‹æ¨¡å¼.

æ™®é€šçš„å•ä¾‹æ¨¡å¼åˆ†ä¸º2ç§, æ‡’æ±‰å¼å’Œé¥¿æ±‰å¼.æ‡’æ±‰å¼æ¯”è¾ƒæ‡’, ç”¨åˆ°çš„æ—¶å€™æ‰åˆ›å»ºå¯¹è±¡, é¥¿æ±‰å¼ä¸è®²ç†, ä½ ç”¨ä¸ç”¨æˆ‘éƒ½åˆ›å»ºå¥½æ”¾ç€.  

![é™é¾™åå…«æŒç§˜ç±](http://localhost/img/common/secret.jpg)

æ™®é€šå•ä¾‹æ¨¡å¼çš„ç§˜ç±:
* å°†æ„é€ å‡½æ•°å®šä¹‰ä¸ºç§æœ‰`private`, åªèƒ½åœ¨æœ¬ç±»ä¸­åˆ›å»º, ä¸èƒ½è¢«ç»§æ‰¿. 
* é€šè¿‡`private`å’Œ`static`å…³é”®å­—å®šä¹‰ä¸€ä¸ªç§æœ‰å¹¶ä¸”é™æ€çš„æœ¬ç±»å®ä¾‹å¯¹è±¡, ä¿è¯å†…å­˜ä¸­åªæœ‰1ä¸ªå®ä¾‹, å¹¶ä¸”åªæœ‰æœ¬ç±»èƒ½è°ƒç”¨. 
* å…¬å¼€ä¸€ä¸ªè·å¾—æœ¬ç±»å®ä¾‹çš„é™æ€æ–¹æ³•, æ¥è·å–è¿™ä¸ªå®ä¾‹, ä¿è¯æ¯æ¬¡å¾—åˆ°çš„å®ä¾‹éƒ½æ˜¯åŒä¸€ä¸ª, æ¥å®ç°å•ä¾‹æ¨¡å¼.

åˆ—å‡º4ç§å¸¸ç”¨çš„å•ä¾‹æ¨¡å¼çš„å†™æ³•, æ¨èç¬¬4ç§. ç¬¬4ç§æ˜¯é€šè¿‡å†…éƒ¨ç±»å®ç°, é«˜æ•ˆä¸”çº¿ç¨‹å®‰å…¨. è®°ä½è¿™ä¸ªå¥½äº†, å…¶ä»–çš„å¯ä»¥å¿˜.

###1.æ‡’æ±‰å¼
```java
/**
 * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼
 */
class Singleton1 {

    private static Singleton1 singleton1;

    private Singleton1() {

    }

    public static Singleton1 getInstance() {
        if (null == singleton1) {
            singleton1 = new Singleton1();
        }
        return singleton1;
    }
}
```
###2.é¥¿æ±‰å¼
```java
/**
 * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼
 */
class Singleton2 {

    private static Singleton2 singleton2 = new Singleton2();

    private Singleton2() {
    }

    public static Singleton2 getInstance() {
        return singleton2;
    }
}
```

###3.çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼
```java
/**
 * çº¿ç¨‹å®‰å…¨æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼
 */
class Singleton3 {

    private static Singleton3 singleton3;

    private Singleton3() {

    }

    public static synchronized Singleton3 getInstance() {
        if (null == singleton3) {
            singleton3 = new Singleton3();
        }
        return singleton3;
    }
}

```
###4.å†…éƒ¨ç±»çº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼
è¿™ç§æ–¹å¼åˆ©ç”¨javaçš„`final`å…³é”®å­—ç‰¹æ€§, ä¸€æ—¦èµ‹å€¼æ— æ³•æ”¹å˜.çº¿ç¨‹å®‰å…¨,æ•ˆç‡é«˜æ¨èæ–¹å¼.

```java
/**
 * å†…éƒ¨ç±»çº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼
 */
class Singleton4 {

    private static class SingletonHolder {
        public final static Singleton4 instance = new Singleton4();
    }

    public static Singleton4 getInstance() {
        return SingletonHolder.instance;
    }
}

```
â‘¢ å·¥å‚æ¨¡å¼
---
å·¥å‚æ¨¡å¼æœ¬è´¨æ˜¯é€šè¿‡æ¡ä»¶è¯­å¥,æ ¹æ®ä¸åŒçš„æ¡ä»¶åˆ›å»ºä¸åŒçš„å¯¹è±¡.é€šå¸¸æƒ…å†µä¸‹, äº§ç”Ÿçš„å¯¹è±¡ç»§æ‰¿è‡ªåŒä¸€ä¸ªçˆ¶ç±», å·¥å‚ç±»æä¾›çš„æ–¹æ³•è¿”å›çš„ç±»å‹ä¸ºçˆ¶ç±»å¯¹è±¡ç±»å‹.è¾¾åˆ°å¯¹è±¡å°è£…çš„ä½œç”¨.

ä»£ç ç¤ºä¾‹:
```java
package com.dashidan.lesson19;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * <p>
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  19.Javaè®¾è®¡æ¨¡å¼
 * å·¥å‚æ¨¡å¼
 */
public class Demo2 {
    public static void main(String[] args) {
        /** ä¼ å…¥éœ€è¦ç”Ÿäº§çš„äº§å“ç±»å‹*/
        Product product = Factory.getProduct(1);
        /** æ‰“å°äº§å“ä¿¡æ¯*/
        product.info();
    }
}

/**
 * å·¥å‚æ¨¡å¼
 * æ ¹æ®ä¸åŒçš„ç±»å‹ï¼Œç”Ÿäº§ä¸åŒçš„äº§å“
 */
class Factory {
    public static Product getProduct(int type) {
        switch (type) {
            case 1:
                return new Product1();
            case 2:
                return new Product2();
        }
        return null;
    }
}

/**
 * äº§å“çš„çˆ¶ç±»æ˜¯æŠ½è±¡ç±»ï¼Œæä¾›ä¸€ä¸ªinfoæ–¹æ³•
 */
abstract class Product {

    public abstract void info();
}

/**
 * äº§å“Product1ç»§æ‰¿è‡ªçˆ¶ç±»Product
 */
class Product1 extends Product {
    @Override
    public void info() {
        System.out.println("Product1 info.");
    }
}

/**
 * äº§å“Product2ç»§æ‰¿è‡ªçˆ¶ç±»Product
 */
class Product2 extends Product {
    @Override
    public void info() {
        System.out.println("Product2 info.");
    }
}

```
è¾“å‡º:

	Product1 info.

â‘£ è§‚å¯Ÿè€…æ¨¡å¼
---

è§‚å¯Ÿè€…æ¨¡å¼(ä¹Ÿç§°ä¸ºå‘å¸ƒ(publish)-è®¢é˜…(Subscribe)æ¨¡å¼ã€æ¨¡å‹-è§†å›¾(View)æ¨¡å¼ã€æº-æ”¶å¬è€…(Listener)æ¨¡å¼æˆ–ä»å±è€…æ¨¡å¼).æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„é™ä½ä»£ç è€¦åˆåº¦çš„æ–¹å¼.

![é™é¾™åå…«æŒç§˜ç±](http://localhost/img/common/secret.jpg)

è§‚å¯Ÿè€…æ¨¡å¼çš„ç§˜ç±:
* è§‚å¯Ÿè€…åœ¨å‘å¸ƒè€…å¯¹è±¡ä¸Šæ³¨å†Œæ¶ˆæ¯ä¾¦å¬, åŠ å…¥æ¶ˆæ¯ä¾¦å¬åˆ—è¡¨
* å‘å¸ƒè€…éå†æ¶ˆæ¯ä¾¦å¬åˆ—è¡¨, è°ƒç”¨è§‚å¯Ÿè€…æ–¹æ³•å¤„ç†æ¶ˆæ¯
* ä¸åŒçš„è§‚å¯Ÿè€…å¯¹è±¡é€šå¸¸ç»§æ‰¿åŒä¸€ä¸ªè§‚å¯Ÿè€…æ¥å£, é€šè¿‡æ¥å£æ–¹æ³•ç»Ÿä¸€å¤„ç†

é€šå¸¸ç”¨åœ¨ä¸€å¯¹å¤šæˆ–è€…å¤šå¯¹å¤šçš„åœºæ™¯ä¸­, ä¸€ä¸ªå¯¹è±¡æ•°æ®å˜åŒ–äº†, éœ€è¦é€šçŸ¥å…¶ä»–å¯¹è±¡çš„åœºæ™¯. æ¯”å¦‚`ActionScript3`è¯­è¨€åº•å±‚çš„äº‹ä»¶å†’æ³¡æœºåˆ¶, å°±æ˜¯é‡‡ç”¨è§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡.

ä»£ç ç¤ºä¾‹:
```java
package com.dashidan.lesson19;


import java.util.ArrayList;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * <p>
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡:  19.Javaè®¾è®¡æ¨¡å¼
 * è§‚å¯Ÿè€…æ¨¡å¼
 */
public class Demo3 {
    public static void main(String[] args) {
        /** åˆå§‹åŒ–å‘å¸ƒè€…å’Œè§‚å¯Ÿè€…*/
        Publisher publisher = new Publisher();
        Observer1 observer1 = new Observer1();
        Observer2 observer2 = new Observer2();
        /** åŠ å…¥2ä¸ªè§‚å¯Ÿè€…åˆ°å‘å¸ƒè€…çš„æ¶ˆæ¯ä¾¦å¬é˜Ÿåˆ—*/
        publisher.addObserver(observer1);
        publisher.addObserver(observer2);
        /** é€šçŸ¥è§‚å¯Ÿè€…*/
        publisher.notifyAllObserver();
    }
}

/**
 * å‘å¸ƒè€…
 */
class Publisher {

    /**
     * å‘å¸ƒè€…çš„æ¶ˆæ¯ä¾¦å¬é˜Ÿåˆ—
     */
    ArrayList<IObserver> observers = new ArrayList<>();

    /**
     * åŠ å…¥æ¶ˆæ¯ä¾¦å¬é˜Ÿåˆ—
     */
    public void addObserver(IObserver iObserver) {
        System.out.println("åŠ å…¥è§‚å¯Ÿè€…");
        observers.add(iObserver);
    }

    /**
     * é€šçŸ¥ä¾¦å¬é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„è§‚å¯Ÿè€…
     */
    public void notifyAllObserver() {
        for (IObserver iObserver : observers) {
            System.out.println("é€šçŸ¥è§‚å¯Ÿè€…");
            iObserver.action();
        }
    }
}

/**
 * è§‚å¯Ÿè€…æ¥å£
 */
interface IObserver {
    void action();
}

/**
 * è§‚å¯Ÿè€…Observer1ç±»
 */
class Observer1 implements IObserver {
    @Override
    public void action() {
        System.out.println("Observer1 action.");
    }
}

/**
 * è§‚å¯Ÿè€…Observer2ç±»
 */
class Observer2 implements IObserver {
    @Override
    public void action() {
        System.out.println("Observer2 action.");
    }
}
```
è¾“å‡º:

	åŠ å…¥è§‚å¯Ÿè€…
	åŠ å…¥è§‚å¯Ÿè€…
	é€šçŸ¥è§‚å¯Ÿè€…
	Observer1 action.
	é€šçŸ¥è§‚å¯Ÿè€…
	Observer2 action.

â‘¤ ç›¸å…³æ–‡ç« 
---

ğŸ“– [Javaé›†æˆå¼€å‘ç¯å¢ƒ](http://localhost/article/java/basic/Javaé›†æˆå¼€å‘ç¯å¢ƒ.html)   