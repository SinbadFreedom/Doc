<div class="jumbotron">
<p>Javaè™šæ‹Ÿæœºç®€ç§°JVM(Java Virtual Machine).åƒä¸€ä¸ªæ„é€ ååˆ†ç²¾å¯†çš„ä»ªå™¨, æä¾›äº†ä¸€äº›å¯ä»¥è°ƒæ§æœºå™¨è¿è¡ŒçŠ¶æ€çš„å‚æ•°.
è¿™äº›å‚æ•°éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…çš„ç”Ÿäº§ç¯å¢ƒçš„è¦æ±‚æ¥è®¾ç½®.å°±åƒå¤´æ–‡å­—Dä¸­çš„é‚£è¾†è½¦86, åªæœ‰ç»è¿‡å¯¹åº”çš„é…ç½®å’Œè°ƒè¯•, æ‰èƒ½è¾¾åˆ°è·‘è½¦çš„æœ€ä¼˜æ€§èƒ½.</p>
</div>

![è±†è…åº—è‡ªå®¶ç”¨](http://localhost/img/java/basic/22-1.jpg)

<div class="bs-callout bs-callout-warning">
    <h4>ä¸åŒçš„å‚å®¶çš„SDKæœ‰ä¸åŒçš„é…ç½®, æˆ‘ä»¬ä»¥sunå…¬å¸å‡ºå“çš„å®˜æ–¹JDKä¸ºä¾‹ä»‹ç»ä¸‹JVMå‚æ•°.</h4>
</div>

1 æ ‡å‡†é…ç½®é€‰é¡¹
===
```
-d32          ä½¿ç”¨ 32 ä½æ•°æ®æ¨¡å‹ (å¦‚æœå¯ç”¨)
-d64          ä½¿ç”¨ 64 ä½æ•°æ®æ¨¡å‹ (å¦‚æœå¯ç”¨)
-server       é€‰æ‹© "server" VM
			  é»˜è®¤ VM æ˜¯ server.

-cp <ç›®å½•å’Œ zip/jar æ–‡ä»¶çš„ç±»æœç´¢è·¯å¾„>
-classpath <ç›®å½•å’Œ zip/jar æ–‡ä»¶çš„ç±»æœç´¢è·¯å¾„>
			  ç”¨ ; åˆ†éš”çš„ç›®å½•, JAR æ¡£æ¡ˆ
			  å’Œ ZIP æ¡£æ¡ˆåˆ—è¡¨, ç”¨äºæœç´¢ç±»æ–‡ä»¶.
-D<åç§°>=<å€¼>
			  è®¾ç½®ç³»ç»Ÿå±æ€§
-verbose:[class|gc|jni]
			  å¯ç”¨è¯¦ç»†è¾“å‡º
-version      è¾“å‡ºäº§å“ç‰ˆæœ¬å¹¶é€€å‡º
-version:<å€¼>
			  è­¦å‘Š: æ­¤åŠŸèƒ½å·²è¿‡æ—¶, å°†åœ¨
			  æœªæ¥å‘è¡Œç‰ˆä¸­åˆ é™¤.
			  éœ€è¦æŒ‡å®šçš„ç‰ˆæœ¬æ‰èƒ½è¿è¡Œ
-showversion  è¾“å‡ºäº§å“ç‰ˆæœ¬å¹¶ç»§ç»­
-jre-restrict-search | -no-jre-restrict-search
			  è­¦å‘Š: æ­¤åŠŸèƒ½å·²è¿‡æ—¶, å°†åœ¨
			  æœªæ¥å‘è¡Œç‰ˆä¸­åˆ é™¤.
			  åœ¨ç‰ˆæœ¬æœç´¢ä¸­åŒ…æ‹¬/æ’é™¤ç”¨æˆ·ä¸“ç”¨ JRE
-? -help      è¾“å‡ºæ­¤å¸®åŠ©æ¶ˆæ¯
-X            è¾“å‡ºéæ ‡å‡†é€‰é¡¹çš„å¸®åŠ©
-ea[:<packagename>...|:<classname>]
-enableassertions[:<packagename>...|:<classname>]
			  æŒ‰æŒ‡å®šçš„ç²’åº¦å¯ç”¨æ–­è¨€
-da[:<packagename>...|:<classname>]
-disableassertions[:<packagename>...|:<classname>]
			  ç¦ç”¨å…·æœ‰æŒ‡å®šç²’åº¦çš„æ–­è¨€
-esa | -enablesystemassertions
			  å¯ç”¨ç³»ç»Ÿæ–­è¨€
-dsa | -disablesystemassertions
			  ç¦ç”¨ç³»ç»Ÿæ–­è¨€
-agentlib:<libname>[=<é€‰é¡¹>]
			  åŠ è½½æœ¬æœºä»£ç†åº“ <libname>, ä¾‹å¦‚ -agentlib:hprof
			  å¦è¯·å‚é˜… -agentlib:jdwp=help å’Œ -agentlib:hprof=help
-agentpath:<pathname>[=<é€‰é¡¹>]
			  æŒ‰å®Œæ•´è·¯å¾„ååŠ è½½æœ¬æœºä»£ç†åº“
-javaagent:<jarpath>[=<é€‰é¡¹>]
			  åŠ è½½ Java ç¼–ç¨‹è¯­è¨€ä»£ç†, è¯·å‚é˜… java.lang.instrument
-splash:<imagepath>
			  ä½¿ç”¨æŒ‡å®šçš„å›¾åƒæ˜¾ç¤ºå¯åŠ¨å±å¹•
```
2 éæ ‡å‡†é…ç½®é€‰é¡¹
===
```
-Xmixed           æ··åˆæ¨¡å¼æ‰§è¡Œ (é»˜è®¤)
-Xint             ä»…è§£é‡Šæ¨¡å¼æ‰§è¡Œ
-Xbootclasspath:<ç”¨ ; åˆ†éš”çš„ç›®å½•å’Œ zip/jar æ–‡ä»¶>
				  è®¾ç½®æœç´¢è·¯å¾„ä»¥å¼•å¯¼ç±»å’Œèµ„æº
-Xbootclasspath/a:<ç”¨ ; åˆ†éš”çš„ç›®å½•å’Œ zip/jar æ–‡ä»¶>
				  é™„åŠ åœ¨å¼•å¯¼ç±»è·¯å¾„æœ«å°¾
-Xbootclasspath/p:<ç”¨ ; åˆ†éš”çš„ç›®å½•å’Œ zip/jar æ–‡ä»¶>
				  ç½®äºå¼•å¯¼ç±»è·¯å¾„ä¹‹å‰
-Xdiag            æ˜¾ç¤ºé™„åŠ è¯Šæ–­æ¶ˆæ¯
-Xnoclassgc       ç¦ç”¨ç±»åƒåœ¾æ”¶é›†
-Xincgc           å¯ç”¨å¢é‡åƒåœ¾æ”¶é›†
-Xloggc:<file>    å°† GC çŠ¶æ€è®°å½•åœ¨æ–‡ä»¶ä¸­ (å¸¦æ—¶é—´æˆ³)
-Xbatch           ç¦ç”¨åå°ç¼–è¯‘
-Xms<size>        è®¾ç½®åˆå§‹ Java å †å¤§å° ç¤ºä¾‹:
					-Xms6291456
					-Xms6144k
					-Xms6m
					-Xms1g
-Xmx<size>        è®¾ç½®æœ€å¤§ Java å †å¤§å°
-Xss<size>        è®¾ç½® Java çº¿ç¨‹å †æ ˆå¤§å°
-Xprof            è¾“å‡º cpu é…ç½®æ–‡ä»¶æ•°æ®
-Xfuture          å¯ç”¨æœ€ä¸¥æ ¼çš„æ£€æŸ¥, é¢„æœŸå°†æ¥çš„é»˜è®¤å€¼
-Xrs              å‡å°‘ Java/VM å¯¹æ“ä½œç³»ç»Ÿä¿¡å·çš„ä½¿ç”¨ (è¯·å‚é˜…æ–‡æ¡£)
-Xcheck:jni       å¯¹ JNI å‡½æ•°æ‰§è¡Œå…¶ä»–æ£€æŸ¥
-Xshare:off       ä¸å°è¯•ä½¿ç”¨å…±äº«ç±»æ•°æ®
-Xshare:auto      åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨å…±äº«ç±»æ•°æ® (é»˜è®¤)
-Xshare:on        è¦æ±‚ä½¿ç”¨å…±äº«ç±»æ•°æ®, å¦åˆ™å°†å¤±è´¥.
-XshowSettings    æ˜¾ç¤ºæ‰€æœ‰è®¾ç½®å¹¶ç»§ç»­
-XshowSettings:all
				  æ˜¾ç¤ºæ‰€æœ‰è®¾ç½®å¹¶ç»§ç»­
-XshowSettings:vm æ˜¾ç¤ºæ‰€æœ‰ä¸ vm ç›¸å…³çš„è®¾ç½®å¹¶ç»§ç»­
-XshowSettings:properties
				  æ˜¾ç¤ºæ‰€æœ‰å±æ€§è®¾ç½®å¹¶ç»§ç»­
-XshowSettings:locale
				  æ˜¾ç¤ºæ‰€æœ‰ä¸åŒºåŸŸè®¾ç½®ç›¸å…³çš„è®¾ç½®å¹¶ç»§ç»­
```
3 JVMæ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹
===

* é«˜ååé‡(`Higher Throughput`)JVMæ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹:


	java -d64 -server -XX:+AggressiveOpts -XX:+UseLargePages -Xmn10g  -Xms26g -Xmx26g 

* ä½å»¶è¿Ÿ(`Lower Response Time`)JVMæ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹:


	java -d64 -XX:+UseG1GC -Xms26g Xmx26g -XX:MaxGCPauseMillis=500 -XX:+PrintGCTimeStamps 


4 è‘—åä¸­é—´ä»¶jvmå‚æ•°é…ç½®
===

###1.`zookeeper`JVMå‚æ•°è®¾ç½®
```
-XX:+HeapDumpOnOutOfMemoryError 
-XX:OnOutOfMemoryError=kill -9 %p 
-Xmx1000m 
-Dcom.sun.management.jmxremote 
-Dcom.sun.management.jmxremote.local.only=false 
```
###2.`apollo`JVMå‚æ•°è®¾ç½®
```
-ea 
-server 
-Xmx1G 
-XX:+HeapDumpOnOutOfMemoryError 
-XX:-UseBiasedLocking 
-Dcom.sun.management.jmxremote 
```
###3.å‚æ•°è¯´æ˜:
```
-XX:+HeapDumpOnOutOfMemoryErrorå‚æ•°è¡¨ç¤ºå½“JVMå‘ç”Ÿå†…å­˜æº¢å‡ºæ—¶,è‡ªåŠ¨ç”Ÿæˆä¿¡æ¯æ–‡ä»¶.
-XX:HeapDumpPath=${path} ç”Ÿæˆä¿¡æ¯æ–‡ä»¶çš„è·¯å¾„.ä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ä»¶åç§°.ä¾‹å¦‚: 
	-XX:HeapDumpPath=${path}/java_heapdump.hprof. å¦‚æœä¸æŒ‡å®šæ–‡ä»¶å,é»˜è®¤åä¸º:java_<pid>_<date>_<time>_heapDump.hprof.
-Dcom.sun.management.jmxremote
	é€šè¿‡JMXçš„æ–¹å¼è¿œç¨‹ç›‘æ§JVMçš„è¿è¡Œæƒ…å†µ.
```
5 å»ºè®®é…ç½®
===

ä»¥ä¸‹æ˜¯ä¸ªäººå»ºè®®, ä¸ä¸€å®šä½¿ç”¨å…¨éƒ¨åœºæ™¯.æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯é…ç½®.
```	
-d64 
-Xms4g 
-Xmx4g
-XX:+HeapDumpOnOutOfMemoryError
-Dcom.sun.management.jmxremote
```
<div class="bs-callout bs-callout-success">
    <h4>ä¸è¦è¿‡åˆ†çº ç»“</h4>
	æœ‰æ—¶é‡‡ç”¨æ›´é«˜é…ç½®çš„ç¡¬ä»¶æ›´æœ‰æ•ˆ.
</div>

6 å‚è€ƒæ–‡ç« 
===

ğŸ“– [é…ç½®jvmå’Œjavaå‚æ•°](https://docs.oracle.com/cd/E22289_01/html/821-1274/configuring-the-default-jvm-and-java-arguments.html)

ğŸ“– [javaæŠ€æœ¯æ–‡æ¡£](http://docs.oracle.com/javase/7/docs/technotes/tools/windows/java.html)
	
7 ç›¸å…³æ–‡ç« 
===

ğŸ“– [Javaä»å…¥é—¨åˆ°ç²¾é€šç´¢å¼•](http://localhost/article/java/basic/index.html)