16.Javaå¼‚å¸¸
===

<div class="jumbotron">
<p>Javaå¼‚å¸¸æ˜¯Javaæä¾›çš„ä¸€ç§è¯†åˆ«åŠå“åº”é”™è¯¯çš„ä¸€è‡´æ€§æœºåˆ¶.
</p>
</div>

â‘  Javaå¼‚å¸¸æœºåˆ¶ç›¸å…³å…³é”®å­—
---
Javaå¼‚å¸¸æœºåˆ¶ç›¸å…³å…³é”®å­—æœ‰: `try`ã€`catch`ã€`finally`ã€`throw`ã€`throws`.
å…³é”®å­—è§£é‡Š:   
* try ç”¨äºç›‘å¬. å°†è¢«ç›‘å¬çš„ä»£ç (å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç )æ”¾åœ¨tryè¯­å¥å—ä¹‹å†…, å½“tryè¯­å¥å—å†…å‘ç”Ÿå¼‚å¸¸æ—¶,å¼‚å¸¸å°±è¢«æŠ›å‡º.
* catch ç”¨æ¥æ•è·tryè¯­å¥å—ä¸­å‘ç”Ÿçš„å¼‚å¸¸.
* finally finallyè¯­å¥å—æ€»æ˜¯ä¼šè¢«æ‰§è¡Œ. ä¸»è¦ç”¨äºå›æ”¶åœ¨`try`å—é‡Œæ‰“å¼€çš„ç‰©ç†èµ„æº(å¦‚æ–‡ä»¶, ç½‘ç»œè¿æ¥, æ•°æ®åº“è¿æ¥ç­‰).

<div class="bs-callout bs-callout-warning">
<h4>finallyè¯­å¥ä¸­return</h4>
<p>åªæœ‰finallyå—æ‰§è¡Œå®Œæˆä¹‹å,æ‰ä¼šæ‰§è¡Œtryæˆ–è€…catchå—ä¸­çš„returnæˆ–è€…throwè¯­å¥. å¦‚æœfinallyä¸­ä½¿ç”¨äº†returnæˆ–è€…throwç­‰ç»ˆæ­¢æ–¹æ³•çš„è¯­å¥,åˆ™å°±ä¸ä¼šè·³å›æ‰§è¡Œ,ç›´æ¥åœæ­¢.
</p>
</div>

* throw ç”¨äºæŠ›å‡ºå¼‚å¸¸.
* throws ç”¨åœ¨æ–¹æ³•ç­¾åä¸­,ç”¨äºå£°æ˜è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸.

â‘¡ Javaå¼‚å¸¸æ¡†æ¶
---
Javaå°†å¯æŠ›å‡º(Throwable)çš„ç»“æ„åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š

* ç¼–è¯‘å¼‚å¸¸(Checked Exception)
* è¿è¡Œæ—¶å¼‚å¸¸(RuntimeException)
* é”™è¯¯(Error)

Javaå¼‚å¸¸æ¡†æ¶ç»§æ‰¿å…³ç³»å¦‚å›¾:
![å›¾15-1](http://localhost/img/java/basic/15-1.jpg)

###1.Throwable
`Throwable`æ˜¯`Java`è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯æˆ–å¼‚å¸¸çš„è¶…ç±», åŒ…å«ä¸¤ä¸ªå­ç±»:`Error`å’Œ`Exception`.å®ƒä»¬é€šå¸¸ç”¨äºæŒ‡ç¤ºå‘ç”Ÿäº†å¼‚å¸¸æƒ…å†µ.`Throwable`åŒ…å«äº†å…¶çº¿ç¨‹åˆ›å»ºæ—¶çº¿ç¨‹æ‰§è¡Œå †æ ˆçš„å¿«ç…§,æä¾›äº†`printStackTrace()`ç­‰æ¥å£ç”¨äºè·å–å †æ ˆè·Ÿè¸ªæ•°æ®ç­‰ä¿¡æ¯.

###2.è¿è¡Œæ—¶å¼‚å¸¸RuntimeException 

`RuntimeException`æ˜¯é‚£äº›å¯èƒ½åœ¨`Java`è™šæ‹Ÿæœºæ­£å¸¸è¿è¡ŒæœŸé—´æŠ›å‡ºçš„å¼‚å¸¸çš„è¶…ç±», ç®€ç§°`è¿è¡Œæ—¶å¼‚å¸¸`. RuntimeExceptionåŠå…¶å­ç±»éƒ½è¢«ç§°ä¸ºè¿è¡Œæ—¶å¼‚å¸¸.

Javaç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥è¿è¡Œæ—¶å¼‚å¸¸.å½“ç¨‹åºä¸­å¯èƒ½å‡ºç°è¿™ç±»å¼‚å¸¸æ—¶,å€˜è‹¥æ—¢"æ²¡æœ‰é€šè¿‡throwså£°æ˜æŠ›å‡ºå®ƒ",ä¹Ÿ"æ²¡æœ‰ç”¨try-catchè¯­å¥æ•è·å®ƒ",è¿˜æ˜¯ä¼šç¼–è¯‘é€šè¿‡.

è™½ç„¶Javaç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥è¿è¡Œæ—¶å¼‚å¸¸, ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡throwsè¿›è¡Œå£°æ˜æŠ›å‡º, ä¹Ÿå¯ä»¥é€šè¿‡try-catchå¯¹å®ƒè¿›è¡Œæ•è·å¤„ç†. å¦‚æœäº§ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸,åˆ™éœ€è¦é€šè¿‡ä¿®æ”¹ä»£ç æ¥è¿›è¡Œé¿å….

ä¾‹å¦‚ï¼š   
* é™¤æ•°ä¸ºé›¶æ—¶äº§ç”Ÿçš„ArithmeticExceptionå¼‚å¸¸
* æ•°ç»„è¶Šç•Œæ—¶äº§ç”Ÿçš„IndexOutOfBoundsExceptionå¼‚å¸¸
* fail-failæœºåˆ¶äº§ç”Ÿçš„ConcurrentModificationExceptionå¼‚å¸¸ç­‰,éƒ½å±äºè¿è¡Œæ—¶å¼‚å¸¸.   

<table class="table table-bordered table-responsive">
    <caption>éƒ¨åˆ†å¸¸ç”¨è¿è¡Œæ—¶å¼‚å¸¸è¯´æ˜</caption>
    <thead>
        <tr class="success">
            <td>å¼‚å¸¸</td>
            <td>æè¿°</td>
        </tr>
    </thead>
    <tbody>		
        <tr class="active">
            <td>ArithmeticException</td>
            <td>é™¤æ•°ä¸ºé›¶å¼‚å¸¸</td>
        </tr>
		<tr>
			<td>ArrayIndexOutOfBoundsException</td>
			<td>æ•°ç»„è¶Šç•Œ</td>
        </tr>
		<tr class="active">
			<td>ClassCastException</td>
			<td>å¯¹è±¡è½¬å‹é”™è¯¯</td>
        </tr>
		<tr>
			<td>IllegalArgumentException</td>
			<td>å‚æ•°ä¸åˆæ³•</td>
        </tr>
		<tr class="active">
			<td>IndexOutOfBoundsException</td>
			<td>æŒ‡ç¤ºæŸæ’åºç´¢å¼•(ä¾‹å¦‚å¯¹æ•°ç»„ã€å­—ç¬¦ä¸²æˆ–å‘é‡çš„æ’åº)è¶…å‡ºèŒƒå›´</td>
        </tr>
		<tr>
			<td>NegativeArraySizeException</td>
			<td>æ•°ç»„é•¿åº¦ä¸ºè´Ÿå€¼</td>
        </tr>
		<tr class="active">
			<td>NullPointerException</td>
			<td>ç©ºæŒ‡é’ˆå¼‚å¸¸</td>
        </tr>
		<tr>
			<td>NumberFormatException</td>
			<td>å½“åº”ç”¨ç¨‹åºè¯•å›¾å°†å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ç§æ•°å€¼ç±»å‹,ä½†è¯¥å­—ç¬¦ä¸²ä¸èƒ½è½¬æ¢ä¸ºé€‚å½“æ ¼å¼æ—¶,æŠ›å‡ºè¯¥å¼‚å¸¸.</td>
        </tr>
	</tbody>
</table>


###3.ç¼–è¯‘å¼‚å¸¸Exception
`Exception`ç±»ä»¥åŠ`Exception`çš„å­ç±»ä¸­é™¤äº†"è¿è¡Œæ—¶å¼‚å¸¸"ä¹‹å¤–çš„å…¶å®ƒå­ç±»éƒ½å±äºè¢«æ£€æŸ¥å¼‚å¸¸. æ­¤ç±»å¼‚å¸¸,è¦ä¹ˆé€šè¿‡throwsè¿›è¡Œå£°æ˜æŠ›å‡º,è¦ä¹ˆé€šè¿‡try-catchè¿›è¡Œæ•è·å¤„ç†,å¦åˆ™ä¸èƒ½é€šè¿‡ç¼–è¯‘.

<table class="table table-bordered table-responsive">
    <caption>éƒ¨åˆ†å¸¸ç”¨ç¼–è¯‘å¼‚å¸¸è¯´æ˜</caption>
    <thead>
        <tr class="success">
            <td>å¼‚å¸¸</td>
            <td>æè¿°</td>
        </tr>
    </thead>
    <tbody>		
        <tr class="active">
            <td>ClassNotFoundException</td>
            <td>åº”ç”¨ç¨‹åºè¯•å›¾åŠ è½½ç±»æ—¶,æ‰¾ä¸åˆ°ç›¸åº”çš„ç±»,æŠ›å‡ºè¯¥å¼‚å¸¸.</td>
        </tr>
		<tr>
			<td>FileNotFoundException</td>
			<td>æ–‡ä»¶ä¸å­˜åœ¨å¼‚å¸¸</td>
        </tr>
		<tr class="active">
			<td>ClassCastException</td>
			<td>å¯¹è±¡è½¬å‹é”™è¯¯</td>
        </tr>
		<tr>
			<td>InterruptedException</td>
			<td>ä¸€ä¸ªçº¿ç¨‹è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ–­,æŠ›å‡ºè¯¥å¼‚å¸¸.</td>
        </tr>
		<tr class="active">
			<td>NoSuchFieldException</td>
			<td>è¯·æ±‚çš„å˜é‡ä¸å­˜åœ¨</td>
        </tr>
		<tr>
			<td>NoSuchMethodException</td>
			<td>è¯·æ±‚çš„æ–¹æ³•ä¸å­˜åœ¨</td>
        </tr>
	</tbody>
</table>

###4.Error

`Error`ç±»åŠå…¶å­ç±»ç»Ÿç§°`é”™è¯¯`. ç”¨äºæŒ‡ç¤ºè¯•å›¾æ•è·çš„ä¸¥é‡é—®é¢˜, å¤§å¤šæ•°è¿™æ ·çš„é”™è¯¯éƒ½æ˜¯å¼‚å¸¸æ¡ä»¶. å’Œ`è¿è¡Œæ—¶å¼‚å¸¸`ä¸€æ ·, ç¼–è¯‘å™¨ä¹Ÿä¸ä¼šæ£€æŸ¥`Error`. å½“èµ„æºä¸è¶³ã€çº¦æŸå¤±è´¥ã€æˆ–æ˜¯å…¶å®ƒå¯¼è‡´ç¨‹åºæ— æ³•ç»§ç»­è¿è¡Œçš„æ¡ä»¶å‘ç”Ÿæ—¶, å°±äº§ç”Ÿé”™è¯¯. ç¨‹åºæœ¬èº«æ— æ³•ä¿®å¤è¿™äº›é”™è¯¯.

ä¾‹:   
* VirtualMachineErrorå°±å±äºé”™è¯¯.

<div class="bs-callout bs-callout-danger">
<h4>æŒ‰ç…§Javaæƒ¯ä¾‹, ä¸åº”è¯¥å®ç°ä»»ä½•æ–°çš„Errorå­ç±», éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¯ä»¥é‡‡ç”¨Exceptionç±».
</h4>
</div>

<div class="bs-callout bs-callout-success">
<h4>åˆ°åº•è¯¥å“ªä¸€ç§å¼‚å¸¸?</h4>
<p>å¯¹äºå¯ä»¥æ¢å¤çš„æ¡ä»¶ä½¿ç”¨è¢«æ£€æŸ¥å¼‚å¸¸,å¯¹äºç¨‹åºé”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸.è™šæ‹ŸæœºåŠç³»ç»Ÿé”™è¯¯é‡‡ç”¨Error.
</p>
</div>

â‘¢ æ•è·å¼‚å¸¸
---
ä½¿ç”¨`try`å’Œ`catch`å…³é”®å­—å¯ä»¥æ•è·å¼‚å¸¸.`try/catch`ä»£ç å—æ”¾åœ¨å¼‚å¸¸å¯èƒ½å‘ç”Ÿçš„åœ°æ–¹.   

è¯­æ³•å¦‚ä¸‹ï¼š
```java
try {
	/** ç¨‹åºä»£ç */
} catch (Exception e) {
	/** å¼‚å¸¸å¤„ç†*/
}
```
ä¸€ä¸ª`try`ä»£ç å—åé¢è·Ÿéšå¤šä¸ª`catch`ä»£ç å—çš„æƒ…å†µå°±å«å¤šé‡æ•è·. å¯ä»¥åœ¨ try è¯­å¥åé¢æ·»åŠ ä»»æ„æ•°é‡çš„ catch å—.
å¦‚æœä¿æŠ¤ä»£ç ä¸­å‘ç”Ÿå¼‚å¸¸,å¼‚å¸¸è¢«æŠ›ç»™ç¬¬ä¸€ä¸ª catch å—. å¦‚æœæŠ›å‡ºå¼‚å¸¸çš„æ•°æ®ç±»å‹ä¸æ•è·å¼‚å¸¸ç±»å‹åŒ¹é…, å°±ä¼šè¢«æ•è·.
å¦‚æœä¸åŒ¹é…,å®ƒä¼šè¢«ä¼ é€’ç»™ä¸‹ä¸€ä¸ª`catch`å—.ç›´åˆ°å¼‚å¸¸è¢«æ•è·æˆ–è€…é€šè¿‡æ‰€æœ‰çš„`catch`å—.

è¯­æ³•å¦‚ä¸‹ï¼š
```java
try {
	/** ç¨‹åºä»£ç */
} catch (Exception1 e) {
	/** å¼‚å¸¸å¤„ç†*/
} catch (Exception1 e) {
	/** å¼‚å¸¸å¤„ç†*/
}
```

â‘£ æŠ›å‡ºå¼‚å¸¸
---
å¯ä»¥ä½¿ç”¨`throw`å…³é”®å­—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸.
```java
public static void testThrow() {
	/** æ–¹æ³•ä½“*/
	throw new NullPointerException();
}
```

å¦‚æœä¸€ä¸ªæ–¹æ³•æ²¡æœ‰æ•è·ä¸€ä¸ª`ç¼–è¯‘å¼‚å¸¸`, é‚£ä¹ˆè¯¥æ–¹æ³•å¿…é¡»ä½¿ç”¨`throws`å…³é”®å­—æ¥å£°æ˜. `throws`å…³é”®å­—æ”¾åœ¨æ–¹æ³•ç­¾åçš„å°¾éƒ¨.

ç¤ºä¾‹ä»£ç :
```java
public static void testThrows() throws NullPointerException {
	/** æ–¹æ³•ä½“*/
}
```
ä¸€ä¸ªæ–¹æ³•å¯ä»¥å£°æ˜æŠ›å‡ºå¤šä¸ªå¼‚å¸¸,å¤šä¸ªå¼‚å¸¸ä¹‹é—´ç”¨é€—å·éš”å¼€.

ä¾‹å¦‚,ä¸‹é¢çš„æ–¹æ³•å£°æ˜æŠ›å‡º`NullPointerException`å’Œ`ArithmeticException`

ç¤ºä¾‹ä»£ç :
```java
public static void testThrows() throws NullPointerException, ArithmeticException {
	/** æ–¹æ³•ä½“*/
}
```

â‘¤ finallyå…³é”®å­—
---
`finally`å…³é”®å­—ç”¨æ¥åˆ›å»ºåœ¨`try`ä»£ç å—åé¢æ‰§è¡Œçš„ä»£ç å—. æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸,`finally`ä»£ç å—ä¸­çš„ä»£ç æ€»ä¼šè¢«æ‰§è¡Œ. åœ¨`finally`ä»£ç å—ä¸­,å¯ä»¥è¿å…³é—­é“¾æ¥, é‡Šæ”¾ç³»ç»Ÿèµ„æºç­‰å¿…é¡»è¦æ‰§è¡Œçš„è¯­å¥. 

`finally`ä»£ç å—å‡ºç°åœ¨`catch`ä»£ç å—æœ€å.   

è¯­æ³•å¦‚ä¸‹ï¼š
```java
try {
	/** æ–¹æ³•ä½“*/
} catch (Exception e) {
	/** å¼‚å¸¸å¤„ç†*/
} finally {
	/** finallyè¯­å¥*/
}
```

<div class="bs-callout bs-callout-warning">
<h4>finally å—å¹¶éå¼ºåˆ¶æ·»åŠ .</h4>
<p>try ä»£ç åä¸èƒ½æ—¢æ²¡ catch å—ä¹Ÿæ²¡ finally å—.</p>
</div>
ç¤ºä¾‹ä»£ç :
```java
package com.dashidan.lesson15;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * <p>
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡: 15.Javaå¼‚å¸¸
 * æµ‹è¯•finally return
 */
public class Demo2 {
    public static void main(String[] args) {
        int result = testFinallyReturn();
        System.out.println("result: " + result);
    }

    public static int testFinallyReturn() {
        int a;
        try {
            a = 1;
            /** æŠ›å‡ºå¼‚å¸¸*/
            System.out.println("æŠ›å‡ºå¼‚å¸¸");
            throw new NullPointerException();
        } catch (NullPointerException e) {
            a = 2;
            /** æ•è·å¼‚å¸¸*/
            System.out.println("æ•è·å¼‚å¸¸");
            e.printStackTrace();
            /** æ³¨æ„è¿™é‡Œæ²¡æœ‰è¿”å›*/
            System.out.println("æ³¨æ„è¿™é‡Œæ²¡æœ‰è¿”å›");
            return a;
        } finally {
            a = 3;
            System.out.println("finallyæ‰§è¡Œè¿”å›");
            /** æŠ›å‡ºå¼‚å¸¸å, æ‰§è¡Œfinallyçš„è¯­å¥, å¦‚æœè¿™é‡Œè¿”å›ï¼Œä¸å†æ‰§è¡Œcatchä¸­è¯­å¥*/
            return a;
        }
    }
}
```
è¾“å‡º:

	æŠ›å‡ºå¼‚å¸¸
	æ•è·å¼‚å¸¸
	æ³¨æ„è¿™é‡Œæ²¡æœ‰è¿”å›
	finallyæ‰§è¡Œè¿”å›
	result: 3
	java.lang.NullPointerException
		at com.dashidan.lesson15.Demo2.testFinallyReturn(Demo2.java:21)
		at com.dashidan.lesson15.Demo2.main(Demo2.java:11)
		at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
		at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
		at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
		at java.lang.reflect.Method.invoke(Method.java:497)
		at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)

â‘¥ è‡ªå®šä¹‰å¼‚å¸¸
---
åœ¨`Java`ä¸­è‡ªå®šä¹‰å¼‚å¸¸éœ€è¦æ³¨æ„:
* æ‰€æœ‰å¼‚å¸¸éƒ½å¿…é¡»æ˜¯ Throwable çš„å­ç±».
* å¦‚æœæƒ³å†™ä¸€ä¸ªæ£€æŸ¥æ€§å¼‚å¸¸ç±»,åˆ™éœ€è¦ç»§æ‰¿ Exception ç±».
* å¦‚æœæƒ³å†™ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ç±»,é‚£ä¹ˆéœ€è¦ç»§æ‰¿ RuntimeException ç±».
```java
package com.dashidan.lesson15;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * <p>
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡: 15.Javaå¼‚å¸¸
 * è‡ªå®šä¹‰å¼‚å¸¸
 */
public class SelfException extends Exception {
}

```
ç¤ºä¾‹ä»£ç :

```java
package com.dashidan.lesson15;

/**
 * å¤§å±è›‹æ•™ç¨‹ç½‘-dashidan.com
 * <p>
 * Javaæ•™ç¨‹åŸºç¡€ç¯‡: 15.Javaå¼‚å¸¸
 */
public class Demo1 {
    public static void main(String[] args) {
        try {
            /** æ–¹æ³•ä½“*/
            testThrow();
            testThrows();
        } catch (NullPointerException e) {
            /** å¼‚å¸¸å¤„ç†*/
            System.out.println("run catch NullPointerException.");
            e.printStackTrace();
        } catch (Exception e) {
            /** å¼‚å¸¸å¤„ç†*/
            System.out.println("run catch Exception.");
            e.printStackTrace();
        } finally {
            /** finallyè¯­å¥*/
            System.out.println("run finally.");
        }
    }

    public static void testThrow() {
        /** æ–¹æ³•ä½“*/
        throw new NullPointerException();
    }

    public static void testThrows() throws NullPointerException, ArithmeticException {
        /** æ–¹æ³•ä½“*/
    }
}

```
è¾“å‡º:

	java.lang.NullPointerException
	at com.dashidan.lesson15.Demo1.testThrow(Demo1.java:30)
	at com.dashidan.lesson15.Demo1.main(Demo1.java:12)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)
	run catch NullPointerException.
	run finally.

â‘¦ ç›¸å…³æ–‡ç« 
---

ğŸ“– [Javaé›†æˆå¼€å‘ç¯å¢ƒ](http://localhost/article/java/basic/Javaé›†æˆå¼€å‘ç¯å¢ƒ.html)   